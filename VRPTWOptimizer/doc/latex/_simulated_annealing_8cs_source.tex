\hypertarget{_simulated_annealing_8cs_source}{}\doxysection{Simulated\+Annealing.\+cs}
\label{_simulated_annealing_8cs_source}\index{SimulatedAnnealing.cs@{SimulatedAnnealing.cs}}
\mbox{\hyperlink{_simulated_annealing_8cs}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00001}00001 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_common_g_i_s}{CommonGIS}}.\mbox{\hyperlink{namespace_common_g_i_s_1_1_interfaces}{Interfaces}};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00002}00002 \textcolor{keyword}{using} System;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00003}00003 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00004}00004 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_v_r_p_t_w_optimizer}{VRPTWOptimizer}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_interfaces}{Interfaces}};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00005}00005 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_v_r_p_t_w_optimizer}{VRPTWOptimizer}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l}{BL}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a}{SA}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_classes}{Classes}};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00006}00006 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00007}00007 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_simulated_annealing}{VRPTWOptimizer.BL.SA.SimulatedAnnealing}}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00008}00008 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00012}00012     \textcolor{keyword}{internal} \textcolor{keyword}{class }SimulatedAnnealing}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00013}00013     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00014}00014         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} adaptive\_probability;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00015}00015         \textcolor{keyword}{public} \textcolor{keywordtype}{double} beta;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00016}00016         \textcolor{comment}{// dwa wektory stosowane do okreslenia prawdopodobienstwa zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00017}00017         \textcolor{keyword}{public} List<double> distrBegin;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00018}00018         \textcolor{comment}{// jezeli wylosowana liczba p z [0..1] jest z przedzialu}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00019}00019         \textcolor{keyword}{public} List<double> distrEnd;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00020}00020         \textcolor{comment}{// czynnik obnizajacy temperature, Beta < 1}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00021}00021         \textcolor{keyword}{public} \textcolor{keywordtype}{int} epoch;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00022}00022         \textcolor{keyword}{public} \textcolor{keywordtype}{int} epochWithoutImprov;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00023}00023         \textcolor{keyword}{public} \textcolor{keywordtype}{double} gamma; \textcolor{comment}{// czynnik skalujacy temperature poczatkowa <=1}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00025}00025         \textcolor{comment}{// liczba epok, Epoch > 0}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00026}00026         \textcolor{keyword}{public} \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00027}00027         \textcolor{keyword}{public} \textcolor{keywordtype}{int} lastEpoch;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00028}00028         \textcolor{comment}{// ostatnia wykonywana epoka przed przerwaniem pracy optymalizatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00029}00029         \textcolor{keyword}{public} \textcolor{keywordtype}{int} lastIter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00030}00030         \textcolor{keyword}{public} List<double> moveProbs;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00031}00031         \textcolor{comment}{// liczba iteracji w epoce, Iter > 1}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00032}00032         \textcolor{keyword}{public} \textcolor{keywordtype}{int} nTry;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00033}00033         \textcolor{keyword}{public} \textcolor{keywordtype}{double}[] operator\_efficiency;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00034}00034         \textcolor{keyword}{public} \textcolor{keywordtype}{double}[] prob;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00035}00035         \textcolor{comment}{// wagi dla czastkowych funkcji kosztu}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00036}00036         \textcolor{keyword}{public} \textcolor{keywordtype}{int} probability\_refresh\_frequency;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00037}00037         \textcolor{keyword}{public} \textcolor{keywordtype}{double} T0;                               \textcolor{comment}{// temperatura poczatkowa}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00038}00038         \textcolor{keyword}{public} List<double> tempHistory;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00039}00039         \textcolor{keyword}{public} \textcolor{keywordtype}{double}[] weights;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00040}00040         \textcolor{comment}{// maksymalna liczba prob wygenerowania dopuszczalnego sasiada aktualnego rozwiazania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00041}00041         \textcolor{keyword}{public} TSolution X0;                            \textcolor{comment}{// dopuszczalne rozwiazanie startowe}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00042}00042         \textcolor{keyword}{public} TSolution XBest;                         \textcolor{comment}{// najlepsze znalezione do tej pory rozwiazanie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00043}00043         \textcolor{keywordtype}{double} probPhase = 1.0 / SimmulatedAnnealingVRPTWOptimizer.NUMBEROFSAOPERATORS;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00055}00055         \textcolor{keyword}{public} SimulatedAnnealing(\textcolor{keywordtype}{double} aGamma, \textcolor{keywordtype}{double} aBeta, \textcolor{keywordtype}{int} aEpoch, \textcolor{keywordtype}{int} aIter, \textcolor{keywordtype}{int} aNTry, \textcolor{keywordtype}{bool} adaptive\_prob, \textcolor{keywordtype}{int} probability\_refresh\_frequency, \textcolor{keywordtype}{int} epochWithoutImprov, TSolution aX0, \textcolor{keywordtype}{double}[] aWeights)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00056}00056         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00057}00057             gamma = aGamma;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00058}00058             beta = aBeta;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00059}00059             epoch = aEpoch;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00060}00060             iter = aIter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00061}00061             nTry = aNTry;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00062}00062             X0 = \textcolor{keyword}{new} TSolution(aX0);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00063}00063             weights = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[aWeights.Length];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00064}00064             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < aWeights.Length; i++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00065}00065             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00066}00066                 weights[i] = aWeights[i];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00067}00067             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00068}00068             weights = aWeights;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00069}00069             tempHistory = \textcolor{keyword}{new} List<double>();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00070}00070             prob = SetInitialProbabilities();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00071}00071             \textcolor{comment}{//prob = new double[SimmulatedAnnealingVRPTWOptimizer.NUMBEROFSAOPERATORS-\/1];   // 3 jest liczbą o 1 mniejszą, niż liczba operatorów}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00072}00072             }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00073}00073             \textcolor{comment}{//prob[0] = probPhase;}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00074}00074             \textcolor{comment}{//for(int i = 1; i < prob.Length; i++)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00075}00075            \textcolor{comment}{// \{}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00076}00076            \textcolor{comment}{//     prob[i] = prob[i-\/1] + probPhase;}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00077}00077            \textcolor{comment}{// \}}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00078}00078             operator\_efficiency = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[prob.Length + 1];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00079}00079             adaptive\_probability = adaptive\_prob;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00080}00080             this.probability\_refresh\_frequency = probability\_refresh\_frequency;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00081}00081             this.epochWithoutImprov = epochWithoutImprov;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00082}00082         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00083}00083 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00084}00084         \textcolor{keyword}{public} \textcolor{keywordtype}{double}[] SetInitialProbabilities()}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00085}00085         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00086}00086             \textcolor{keywordtype}{double}[] result = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[SimmulatedAnnealingVRPTWOptimizer.NUMBEROFSAOPERATORS -\/ 1];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00087}00087             result[0] = probPhase;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00088}00088             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < result.Length; i++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00089}00089             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00090}00090                 result[i] = result[i -\/ 1] + probPhase;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00091}00091             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00092}00092             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00093}00093         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00101}00101         \textcolor{keyword}{private} \textcolor{keywordtype}{double} SetStartingTemp(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00102}00102         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00103}00103             X0.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00104}00104             T0 = gamma * X0.cost;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00105}00105             \textcolor{keywordflow}{return} T0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00106}00106         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00116}00116         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} Neighbour(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, ref \textcolor{keywordtype}{int} operator\_index, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00117}00117         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00118}00118             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00119}00119             \textcolor{keywordtype}{double} prob\_los = 0.0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00120}00120             \textcolor{keywordtype}{int} m = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00121}00121             \textcolor{keywordtype}{int} op = -\/1;                 \textcolor{comment}{// indeks operatora, ktory bedzie zastosowany}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00122}00122 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00123}00123             \textcolor{comment}{// losowy dobór operatora w każdej iteracji}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00124}00124             \textcolor{keywordflow}{while} (success\_flag == \textcolor{keyword}{false} \&\& m <= nTry)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00125}00125             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00126}00126                 prob\_los = SimmulatedAnnealingVRPTWOptimizer.rand.NextDouble();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00127}00127                 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00128}00128                 \textcolor{keywordflow}{if} (prob\_los < prob[0])  \textcolor{comment}{// prawd. na początek na stałe, ale docelowo mogą zależeć od skuteczności operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00129}00129                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00130}00130                     success\_flag = TMove\_2opt(Nodes, Vehicles\_SA, x, ref xprim, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00131}00131                     operator\_index = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00132}00132                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00133}00133                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (prob\_los >= prob[0] \&\& prob\_los < prob[1])}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00134}00134                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00135}00135                     success\_flag = TMove\_2opt\_inter(Nodes, Vehicles\_SA, x, ref xprim, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00136}00136                     operator\_index = 1;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00137}00137                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00138}00138                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (prob\_los >= prob[1] \&\& prob\_los < prob[2])}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00139}00139                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00140}00140                     success\_flag = TMove\_Exchange(Nodes, Vehicles\_SA, x, ref xprim, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00141}00141                     operator\_index = 2;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00142}00142                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00143}00143                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (prob\_los >= prob[2] \&\& prob\_los < prob[3])}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00144}00144                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00145}00145                     success\_flag = TMove\_MoveNode(Nodes, Vehicles\_SA, x, ref xprim, param\_7\_penalty\_function\_type,serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00146}00146                     operator\_index = 3;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00147}00147                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00148}00148                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00149}00149                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00150}00150                     success\_flag = TMove\_Exchange\_Vehicle(Nodes, Vehicles\_SA, x, ref xprim, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00151}00151                     operator\_index = 4;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00152}00152                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00153}00153                 m++;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00154}00154             \}\textcolor{comment}{// warunek wyjscia z petli "{}while"{}: (success\_flag == true) OR (m > NTry)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00155}00155             \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00156}00156         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00164}00164         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} Run(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type,\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00165}00165         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00166}00166             TSolution xbest;        \textcolor{comment}{// najlepsze znalezione do tej pory rozwiazanie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00167}00167             TSolution x0;           \textcolor{comment}{// rozwiazanie aktualne}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00168}00168             TSolution x;            \textcolor{comment}{// dopuszczalny sasiad rozwiazania aktualnego}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00169}00169             \textcolor{keywordtype}{bool} fsbl\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00170}00170             \textcolor{keywordtype}{double} T;               \textcolor{comment}{// temperatura obowiązująca w danej epoce}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00171}00171             x = \textcolor{keyword}{new} TSolution(Vehicles\_SA.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00172}00172 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00173}00173             \textcolor{keywordtype}{int} index\_operator = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00174}00174             x0 = \textcolor{keyword}{new} TSolution(X0);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00175}00175 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00176}00176             xbest = \textcolor{keyword}{new} TSolution(x0);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00177}00177             T = SetStartingTemp(Nodes, Vehicles\_SA, param\_7\_penalty\_function\_type,serviceTimeEstimator, distanceProvider);  \textcolor{comment}{// nasza temperatura początkowa, to wartość początkowa rozwiązania pomnożona przez Gamma}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00178}00178             \textcolor{keywordtype}{int} withoutImprov = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00179}00179             \textcolor{keywordtype}{int} iterwithoudImprov = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00180}00180             tempHistory.Add(T);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00181}00181             \textcolor{comment}{// Console.WriteLine("{}[INFO] T\_0: \{0\}"{}, T);}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00182}00182             \textcolor{keywordtype}{double} sum\_efficiency = 0.0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00183}00183             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i <= epoch; i++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00184}00184             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00185}00185                 \textcolor{keywordflow}{if} (i \% 10 == 0)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00186}00186                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00187}00187                     Console.WriteLine(\textcolor{stringliteral}{"{}[INFO] Epoch: \{0\}"{}}, i);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00188}00188                     x0.getResult(Nodes, Vehicles\_SA, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00189}00189                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00190}00190                 \textcolor{keywordflow}{if} ( (i \% 200 == 0) \&\& (adaptive\_probability == \textcolor{keyword}{true}) )}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00191}00191                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00192}00192                     prob = SetInitialProbabilities();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00193}00193                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00194}00194                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((i \% probability\_refresh\_frequency == 0) \&\& (adaptive\_probability == \textcolor{keyword}{true}))}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00195}00195                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00196}00196                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < operator\_efficiency.Length; j++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00197}00197                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00198}00198                         sum\_efficiency += operator\_efficiency[j];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00199}00199                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00200}00200                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < operator\_efficiency.Length; j++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00201}00201                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00202}00202                         operator\_efficiency[j] /= sum\_efficiency;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00203}00203                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00204}00204                     prob[0] = operator\_efficiency[0];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00205}00205 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00206}00206                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 1; j < prob.Length; j++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00207}00207                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00208}00208                         prob[j] = prob[j -\/ 1] + operator\_efficiency[j];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00209}00209                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00210}00210                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < operator\_efficiency.Length; j++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00211}00211                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00212}00212                         operator\_efficiency[j] = 0.0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00213}00213                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00214}00214                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00215}00215 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00216}00216                 iterwithoudImprov = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00217}00217                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 1; j <= iter; j++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00218}00218                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00219}00219                     fsbl\_flag = Neighbour(Nodes,Vehicles\_SA, x0, ref x, ref index\_operator, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);           \textcolor{comment}{// proba wygenerowania x, sasiada x0}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00220}00220                                                                                                                             \textcolor{comment}{// ***: if (fsbl\_flag == false) break;}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00221}00221                     \textcolor{keywordflow}{if} (fsbl\_flag == \textcolor{keyword}{false})}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00222}00222                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00223}00223                         x = \textcolor{keyword}{new} TSolution(xbest);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00224}00224                         \textcolor{comment}{//xbest.Clone(x);}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00225}00225                         fsbl\_flag = \textcolor{keyword}{true};            \textcolor{comment}{// nie wygenerowano dopuszczalnego sasiada, zacznij w  xbest}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00226}00226                                                      \textcolor{comment}{//x = X0; fsbl\_flag = true;            // nie wygenerowano dopuszczalnego sasiada, zacznij w X0}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00227}00227                     \};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00228}00228                     x.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);                        \textcolor{comment}{// dopuszczalny sasiad rozwiazania x0}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00229}00229 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00230}00230                     \textcolor{keywordtype}{double} d = x.cost -\/ x0.cost;                 \textcolor{comment}{// przyrost wartosci funkcji kosztu}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00231}00231                     \textcolor{keywordflow}{if} (d < 0)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00232}00232                     \{                               \textcolor{comment}{// sasiad ma mniejsza wartosc funkcji kosztu, akceptujemy z prawdopodobienstwem 1.0}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00233}00233                         x0 = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00234}00234                         \textcolor{keywordflow}{if} (fsbl\_flag == \textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00235}00235                         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00236}00236                             operator\_efficiency[index\_operator]++;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00237}00237                         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00238}00238                         \textcolor{keywordflow}{if} (x0.cost < xbest.cost)               \textcolor{comment}{// aktualizacja najlepszego znalezionego rozwiazania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00239}00239                         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00240}00240                             xbest = \textcolor{keyword}{new} TSolution(x0);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00241}00241                         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00242}00242                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00243}00243                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00244}00244                     \{                                       \textcolor{comment}{// sasiad ma wieksza lub taka sama wartosc funkcji kosztu}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00245}00245                         \textcolor{keywordtype}{double} f = SimmulatedAnnealingVRPTWOptimizer.rand.NextDouble();                 \textcolor{comment}{// losowa liczba z przedzialu [0,1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00246}00246                         \textcolor{keywordflow}{if} (f < Math.Exp(-\/1.0 * d / T))}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00247}00247                         \{               \textcolor{comment}{// akceptacja gorszego rozwiazania z prawd. exp(-\/1.0*d / T)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00248}00248                             x0 = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00249}00249                         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00250}00250                         iterwithoudImprov++;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00251}00251                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00252}00252                 \}\textcolor{comment}{// iteracja w epoce}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00253}00253                 \textcolor{keywordflow}{if} (fsbl\_flag == \textcolor{keyword}{false}) \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00254}00254                 T = beta * T;                   \textcolor{comment}{// uaktualnienie temperatury dla kolejnej epoki}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00255}00255                 tempHistory.Add(T);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00256}00256                 \textcolor{keywordflow}{if} (iterwithoudImprov == iter)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00257}00257                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00258}00258                     withoutImprov++;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00259}00259                     iterwithoudImprov = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00260}00260                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00261}00261                 \textcolor{keywordflow}{if} (withoutImprov > epochWithoutImprov)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00262}00262                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00263}00263                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00264}00264                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00265}00265             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00266}00266             XBest = \textcolor{keyword}{new} TSolution(xbest);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00267}00267             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00268}00268         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00269}00269 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00278}00278         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} TMove\_2opt(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00279}00279         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00280}00280             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00281}00281             \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00282}00282             \textcolor{keywordtype}{int} K = x.X.Count;                       \textcolor{comment}{// liczba wszystkich tras w rozwiazaniu poczatkowym}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00283}00283             List<int> cand\_routes = \textcolor{keyword}{new} List<int>(); \textcolor{comment}{// numery tras pojazdow, ktore zawieraja co najmniej 2 wezly klienckie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00284}00284             \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00285}00285             \textcolor{keywordtype}{int} r;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00286}00286             \textcolor{keywordtype}{int} index;                               \textcolor{comment}{// i to losowa pozycja wezla trasy, ktory bedzie zamieniony z wezlem na pozycji i+1 trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00287}00287 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00288}00288             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < K; i++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00289}00289             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00290}00290                 \textcolor{keywordflow}{if} (x.X[i].Count >= 4)               \textcolor{comment}{// trasa pojazdu zawiera co najmniej dwoch klientow (minimalna trasa: 0-\/-\/i1-\/-\/i2-\/-\/0)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00291}00291                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00292}00292                     cand\_routes.Add(i);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00293}00293                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00294}00294             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00295}00295             \textcolor{keywordflow}{if} (cand\_routes.Count == 0) \textcolor{keywordflow}{return} \textcolor{keyword}{false};\textcolor{comment}{// brak tras do zastosowania tego operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00296}00296             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00297}00297             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00298}00298                 \textcolor{keywordflow}{for} (iter = 1; iter <= nTry; iter++) \textcolor{comment}{// wylosuj liczbe c z przedzialu [0..and\_routes.size() -\/ 1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00299}00299                 \{                                    \textcolor{comment}{// w cand\_routes[c] jest indeks trasy do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00300}00300                     c = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00301}00301                     xprim = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00302}00302                     r = cand\_routes[c];              \textcolor{comment}{// indeks losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00303}00303                     \textcolor{keywordflow}{if} (xprim.X[r].Count == 4)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00304}00304                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00305}00305                         index = 1;                   \textcolor{comment}{// trasa jest taka 0-\/-\/i1-\/-\/i2-\/-\/0, nie trzeba losowac}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00306}00306                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00307}00307                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00308}00308                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00309}00309                         index = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[r].Count -\/ 3) + 1;  \textcolor{comment}{// losowa pozycja z przedzialu [1..(rozmiar\_trasy)-\/3]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00310}00310                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00311}00311                     \textcolor{comment}{// wymiana wezlow na trasie r (swap)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00312}00312                     \textcolor{keywordtype}{int} temp = xprim.X[r][index + 1];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00313}00313                     xprim.X[r][index + 1] = xprim.X[r][index];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00314}00314                     xprim.X[r][index] = temp;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00315}00315 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00316}00316                     xprim.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00317}00317                     \textcolor{keywordflow}{if} (xprim.solutionFlag == \textcolor{keyword}{true}) \textcolor{comment}{// sasiad jest dopuszczalny}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00318}00318                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00319}00319                         success\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00320}00320                         \textcolor{keywordflow}{break};                          \textcolor{comment}{// przerwij petle prob losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00321}00321                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00322}00322                 \} \textcolor{comment}{// for -\/-\/ proby losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00323}00323                 \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00324}00324             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00325}00325         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00326}00326 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00335}00335         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} TMove\_2opt\_inter(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type,\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00336}00336         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00337}00337             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00338}00338             \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00339}00339             \textcolor{keywordtype}{int} K = x.X.Count;                           \textcolor{comment}{// liczba wszystkich tras w rozwiazaniu poczatkowym}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00340}00340             List<int> cand\_routes = \textcolor{keyword}{new} List<int>();     \textcolor{comment}{// numery tras pojazdow, ktore zawieraja co najmniej 2 wezly klienckie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00341}00341             \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00342}00342             \textcolor{keywordtype}{int} d;                                       \textcolor{comment}{// indeks drugiej trasy w cand\_routes do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00343}00343             \textcolor{keywordtype}{int} r;                                       \textcolor{comment}{// indeks pierwszej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00344}00344             \textcolor{keywordtype}{int} s;                                       \textcolor{comment}{// indeks drugiej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00345}00345             \textcolor{keywordtype}{int} i;                                       \textcolor{comment}{// indeks stosowany do losowania węzła pierwszej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00346}00346             \textcolor{keywordtype}{int} j;                                       \textcolor{comment}{// indeks stosowany do losowania węzła drugiej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00347}00347             List<int> rnew = \textcolor{keyword}{new} List<int>();            \textcolor{comment}{// indeksy wezlow klientow na nowej trasie r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00348}00348             List<int> snew = \textcolor{keyword}{new} List<int>();            \textcolor{comment}{// indeksy wezlow klientow na nowej trasie s}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00349}00349 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00350}00350             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < K; index++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00351}00351             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00352}00352                 \textcolor{keywordflow}{if} (x.X[index].Count >= 3)               \textcolor{comment}{// trasa pojazdu zawiera co najmniej dwoch klientow (minimalna trasa: 0-\/-\/i1-\/-\/i2-\/-\/0)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00353}00353                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00354}00354                     cand\_routes.Add(index);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00355}00355                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00356}00356             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00357}00357             \textcolor{keywordflow}{if} (cand\_routes.Count < 2) \textcolor{keywordflow}{return} \textcolor{keyword}{false};    \textcolor{comment}{// brak tras do zastosowania tego operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00358}00358             \textcolor{keywordflow}{else}                                         \textcolor{comment}{// mozna zastosowac operator}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00359}00359             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00360}00360                 \textcolor{keywordflow}{for} (iter = 1; iter <= nTry; iter++)     \textcolor{comment}{// wylosuj liczbe c z przedzialu [0..and\_routes.size() -\/ 1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00361}00361                 \{                                        \textcolor{comment}{// w cand\_routes[c] jest indeks trasy do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00362}00362                     snew.Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00363}00363                     rnew.Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00364}00364                     c = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00365}00365                     d = c;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00366}00366                     \textcolor{keywordflow}{while} (c == d)                       \textcolor{comment}{// losowanie drugiego indeksu trasy innego od c}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00367}00367                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00368}00368                         d = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00369}00369                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00370}00370 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00371}00371                     xprim = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00372}00372 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00373}00373                     r = cand\_routes[c];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00374}00374                     s = cand\_routes[d];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00375}00375                     i = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[r].Count -\/ 2) + 1;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00376}00376                     j = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[s].Count -\/ 2) + 1;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00378}00378                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < i; p++)          \textcolor{comment}{// nowa trasa, pierwsza część trasy z r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00379}00379                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00380}00380                         rnew.Add(xprim.X[r][p]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00381}00381                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00382}00382                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = j; p < xprim.X[s].Count; p++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00383}00383                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00384}00384                         rnew.Add(xprim.X[s][p]);         \textcolor{comment}{// druga część trasy, węzły z s}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00385}00385                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00387}00387                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < j; p++)          \textcolor{comment}{// nowa trasa, pierwsza część trasy z s}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00388}00388                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00389}00389                         snew.Add(xprim.X[s][p]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00390}00390                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00391}00391                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = i; p < xprim.X[r].Count; p++)   \textcolor{comment}{// druga część trasy, węzły z r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00392}00392                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00393}00393                         snew.Add(xprim.X[r][p]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00394}00394                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00395}00395 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00396}00396                     xprim.X[r].Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00397}00397                     xprim.X[s].Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00398}00398 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00399}00399                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < rnew.Count; p++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00400}00400                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00401}00401                         xprim.X[r].Add(rnew[p]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00402}00402                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00403}00403 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00404}00404                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < snew.Count; p++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00405}00405                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00406}00406                         xprim.X[s].Add(snew[p]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00407}00407                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00408}00408                     xprim.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00409}00409                     \textcolor{keywordflow}{if} (xprim.solutionFlag == \textcolor{keyword}{true}) \textcolor{comment}{// sasiad jest dopuszczalny}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00410}00410                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00411}00411                         success\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00412}00412                         \textcolor{keywordflow}{break};                          \textcolor{comment}{// przerwij petle prob losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00413}00413                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00414}00414                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00415}00415             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00416}00416             \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00417}00417         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00418}00418 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00427}00427 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00428}00428         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} TMove\_Exchange\_Vehicle(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00429}00429         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00430}00430             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};   \textcolor{comment}{// operator do wymiany całych tras pomiędzy dwoma losowymi pojazdami wirtualnymi}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00431}00431             \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00432}00432             \textcolor{keywordtype}{int} K = x.X.Count;                           \textcolor{comment}{// liczba wszystkich tras w rozwiazaniu poczatkowym}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00433}00433             List<int> cand\_routes = \textcolor{keyword}{new} List<int>();     \textcolor{comment}{// numery tras pojazdow, ktore zawieraja co najmniej 2 wezly klienckie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00434}00434             \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00435}00435             \textcolor{keywordtype}{int} d;                                       \textcolor{comment}{// indeks drugiej trasy w cand\_routes do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00436}00436             \textcolor{keywordtype}{int} r;                                       \textcolor{comment}{// indeks pierwszej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00437}00437             \textcolor{keywordtype}{int} s;                                       \textcolor{comment}{// indeks drugiej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00438}00438 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00439}00439             List<int> temp  = \textcolor{keyword}{new} List<int>();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00440}00440 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00441}00441             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < K; index++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00442}00442             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00443}00443               cand\_routes.Add(index);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00444}00444             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00445}00445                 \textcolor{keywordflow}{for} (iter = 1; iter <= nTry; iter++)     \textcolor{comment}{// wylosuj liczbe c z przedzialu [0..and\_routes.size() -\/ 1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00446}00446                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00447}00447                     temp.Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00448}00448                     c = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00449}00449                     d = c;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00450}00450                     \textcolor{keywordflow}{while} (c == d)                       \textcolor{comment}{// losowanie drugiego indeksu trasy innego od c}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00451}00451                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00452}00452                         d = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00453}00453                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00454}00454                     xprim = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00455}00455                     r = cand\_routes[c];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00456}00456                     s = cand\_routes[d];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00457}00457 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00458}00458                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} a = 0; a < xprim.X[r].Count; a++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00459}00459                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00460}00460                         temp.Add(xprim.X[r][a]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00461}00461                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00462}00462                     xprim.X[r].Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00463}00463                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} a = 0; a < xprim.X[s].Count; a++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00464}00464                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00465}00465                         xprim.X[r].Add(xprim.X[s][a]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00466}00466                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00467}00467                     xprim.X[s].Clear();}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00468}00468                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} a = 0; a < temp.Count; a++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00469}00469                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00470}00470                         xprim.X[s].Add(temp[a]);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00471}00471                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00472}00472 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00473}00473                     xprim.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00474}00474                     \textcolor{keywordflow}{if} (xprim.solutionFlag == \textcolor{keyword}{true}) \textcolor{comment}{// sasiad jest dopuszczalny}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00475}00475                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00476}00476                         success\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00477}00477                         \textcolor{keywordflow}{break};                          \textcolor{comment}{// przerwij petle prob losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00478}00478                     \}  }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00479}00479             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00480}00480             \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00481}00481         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00482}00482 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00491}00491         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} TMove\_Exchange(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00492}00492         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00493}00493             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00494}00494             \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00495}00495             \textcolor{keywordtype}{int} K = x.X.Count;                           \textcolor{comment}{// liczba wszystkich tras w rozwiazaniu poczatkowym}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00496}00496             List<int> cand\_routes = \textcolor{keyword}{new} List<int>();     \textcolor{comment}{// numery tras pojazdow, ktore zawieraja co najmniej 2 wezly klienckie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00497}00497             \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00498}00498             \textcolor{keywordtype}{int} d;                                       \textcolor{comment}{// indeks drugiej trasy w cand\_routes do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00499}00499             \textcolor{keywordtype}{int} r;                                       \textcolor{comment}{// indeks pierwszej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00500}00500             \textcolor{keywordtype}{int} s;                                       \textcolor{comment}{// indeks drugiej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00501}00501             \textcolor{keywordtype}{int} i;                                       \textcolor{comment}{// indeks stosowany do losowania węzła pierwszej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00502}00502             \textcolor{keywordtype}{int} j;                                       \textcolor{comment}{// indeks stosowany do losowania węzła drugiej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00503}00503             \textcolor{keywordtype}{int} temp;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00504}00504 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00505}00505             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < K; index++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00506}00506             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00507}00507                 \textcolor{keywordflow}{if} (x.X[index].Count >= 3)               \textcolor{comment}{// trasa pojazdu zawiera co najmniej dwoch klientow (minimalna trasa: 0-\/-\/i1-\/-\/i2-\/-\/0)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00508}00508                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00509}00509                     cand\_routes.Add(index);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00510}00510                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00511}00511             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00512}00512             \textcolor{keywordflow}{if} (cand\_routes.Count < 2) \textcolor{keywordflow}{return} \textcolor{keyword}{false};    \textcolor{comment}{// brak tras do zastosowania tego operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00513}00513             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00514}00514             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00515}00515                 \textcolor{keywordflow}{for} (iter = 1; iter <= nTry; iter++)     \textcolor{comment}{// wylosuj liczbe c z przedzialu [0..and\_routes.size() -\/ 1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00516}00516                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00517}00517                     c = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00518}00518                     d = c;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00519}00519                     \textcolor{keywordflow}{while} (c == d)                       \textcolor{comment}{// losowanie drugiego indeksu trasy innego od c}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00520}00520                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00521}00521                         d = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00522}00522                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00523}00523                     xprim = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00524}00524                     r = cand\_routes[c];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00525}00525                     s = cand\_routes[d];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00526}00526                     i = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[r].Count -\/ 2) + 1;  \textcolor{comment}{// losowanie poyzcji wezla na trasie r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00527}00527                     j = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[s].Count -\/ 2) + 1;  \textcolor{comment}{// losowanie pozycji wezla na trasie s}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00528}00528 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00529}00529                     temp = xprim.X[s][j];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00530}00530                     xprim.X[s][j] = xprim.X[r][i];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00531}00531                     xprim.X[r][i] = temp;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00532}00532                     xprim.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00533}00533                     \textcolor{keywordflow}{if} (xprim.solutionFlag == \textcolor{keyword}{true}) \textcolor{comment}{// sasiad jest dopuszczalny}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00534}00534                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00535}00535                         success\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00536}00536                         \textcolor{keywordflow}{break};                          \textcolor{comment}{// przerwij petle prob losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00537}00537                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00538}00538                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00539}00539             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00540}00540             \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00541}00541         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00542}00542 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00551}00551         \textcolor{keyword}{public} \textcolor{keywordtype}{bool} TMove\_MoveNode(List<TNode> Nodes, List<VVehicle> Vehicles\_SA, TSolution x, ref TSolution xprim, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00552}00552         \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00553}00553             \textcolor{keywordtype}{bool} success\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00554}00554             \textcolor{keywordtype}{int} iter;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00555}00555             \textcolor{keywordtype}{int} K = x.X.Count;                           \textcolor{comment}{// liczba wszystkich tras w rozwiazaniu poczatkowym}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00556}00556             List<int> cand\_routes = \textcolor{keyword}{new} List<int>();     \textcolor{comment}{// numery tras pojazdow, ktore zawieraja co najmniej 2 wezly klienckie}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00557}00557             \textcolor{keywordtype}{int} c = 0;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00558}00558             \textcolor{keywordtype}{int} d;                                       \textcolor{comment}{// indeks drugiej trasy w cand\_routes do zastosowania operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00559}00559             \textcolor{keywordtype}{int} r;                                       \textcolor{comment}{// indeks pierwszej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00560}00560             \textcolor{keywordtype}{int} s;                                       \textcolor{comment}{// indeks drugiej losowo wybranej trasy w rozwiazaniu x}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00561}00561             \textcolor{keywordtype}{int} i;                                       \textcolor{comment}{// indeks stosowany do losowania węzła pierwszej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00562}00562             \textcolor{keywordtype}{int} j;                                       \textcolor{comment}{// indeks stosowany do losowania węzła drugiej trasy}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00563}00563             \textcolor{keywordtype}{int} temp;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00564}00564 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00565}00565             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < K; index++)}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00566}00566             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00567}00567                 \textcolor{keywordflow}{if} (x.X[index].Count >= 3)               \textcolor{comment}{// trasa pojazdu zawiera co najmniej dwoch klientow (minimalna trasa: 0-\/-\/i1-\/-\/i2-\/-\/0)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00568}00568                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00569}00569                     cand\_routes.Add(index);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00570}00570                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00571}00571             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00572}00572             \textcolor{keywordflow}{if} (cand\_routes.Count < 2) \textcolor{keywordflow}{return} \textcolor{keyword}{false};    \textcolor{comment}{// brak tras do zastosowania tego operatora}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00573}00573             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00574}00574             \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00575}00575                 \textcolor{keywordflow}{for} (iter = 1; iter <= nTry; iter++)     \textcolor{comment}{// wylosuj liczbe c z przedzialu [0..and\_routes.size() -\/ 1]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00576}00576                 \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00577}00577                     c = SimmulatedAnnealingVRPTWOptimizer.rand.Next(cand\_routes.Count);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00578}00578                     d = cand\_routes[c];}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00579}00579                     \textcolor{keywordflow}{while} (cand\_routes[c] == d)         \textcolor{comment}{// losowanie drugiego indeksu trasy w rozwiazaniu x innego od cand\_routes[c]}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00580}00580                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00581}00581                         d = SimmulatedAnnealingVRPTWOptimizer.rand.Next(K);               \textcolor{comment}{// bo losujemy nawet trasy puste (0-\/-\/0)}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00582}00582                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00583}00583 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00584}00584                     xprim = \textcolor{keyword}{new} TSolution(x);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00585}00585                     r = cand\_routes[c];                 \textcolor{comment}{// indeks trasy w rozwiazaniu x, z ktorej bedzie zabierany wezel}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00586}00586                     s = d;                              \textcolor{comment}{// indeks trasy w rozwiazaniu x, do ktorej bedzie wstawiany wezel}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00587}00587                     i = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[r].Count -\/ 2) + 1;  \textcolor{comment}{// pozycja losowego wezla trasy r, ktory bedzie zabierany}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00588}00588                     j = SimmulatedAnnealingVRPTWOptimizer.rand.Next(xprim.X[s].Count -\/ 1) + 1;  \textcolor{comment}{// pozycja losowego wezla trasy s, przed ktorum bedzie wstawiany wezel z r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00589}00589 }
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00590}00590                     temp = xprim.X[r][i];           \textcolor{comment}{// indeks klienta, ktory jest w wezle na pozycji i trasy r, wezel na poz. i bedzie usuwany z trasy r}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00591}00591                     xprim.X[r].RemoveAt(i);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00592}00592                     xprim.X[s].Insert(j, temp);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00593}00593                     xprim.Evaluate(Nodes, Vehicles\_SA, weights, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00594}00594                     \textcolor{keywordflow}{if} (xprim.solutionFlag == \textcolor{keyword}{true}) \textcolor{comment}{// sasiad jest dopuszczalny}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00595}00595                     \{}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00596}00596                         success\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00597}00597                         \textcolor{keywordflow}{break};                          \textcolor{comment}{// przerwij petle prob losowania}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00598}00598                     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00599}00599                 \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00600}00600             \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00601}00601             \textcolor{keywordflow}{return} success\_flag;}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00602}00602         \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00603}00603     \}}
\DoxyCodeLine{\Hypertarget{_simulated_annealing_8cs_source_l00604}00604 \}}

\end{DoxyCode}
