\hypertarget{_initial_heuristic_8cs_source}{}\doxysection{Initial\+Heuristic.\+cs}
\label{_initial_heuristic_8cs_source}\index{InitialHeuristic.cs@{InitialHeuristic.cs}}
\mbox{\hyperlink{_initial_heuristic_8cs}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00001}00001 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_common_g_i_s}{CommonGIS}}.\mbox{\hyperlink{namespace_common_g_i_s_1_1_interfaces}{Interfaces}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00002}00002 \textcolor{keyword}{using} System;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00003}00003 \textcolor{keyword}{using} System.Collections.Generic;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00004}00004 \textcolor{keyword}{using} System.Diagnostics;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00005}00005 \textcolor{keyword}{using} System.Linq;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00006}00006 \textcolor{keyword}{using} System.Text;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00007}00007 \textcolor{keyword}{using} System.Threading.Tasks;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00008}00008 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_v_r_p_t_w_optimizer}{VRPTWOptimizer}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l}{BL}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a}{SA}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_classes}{Classes}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00009}00009 \textcolor{keyword}{using} \mbox{\hyperlink{namespace_v_r_p_t_w_optimizer}{VRPTWOptimizer}}.\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_interfaces}{Interfaces}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00011}\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_simulated_annealing}{00011}} \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_simulated_annealing}{VRPTWOptimizer.BL.SA.SimulatedAnnealing}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00012}00012 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00013}00013     \textcolor{keyword}{internal} \textcolor{keyword}{class }InitialHeuristic}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00014}00014     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00021}00021         \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00022}00022 \textcolor{comment}{        public static double CalculateServiceTime(TNode node, ITimeEstimator serviceTimeEstimator)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00023}00023 \textcolor{comment}{        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00024}00024 \textcolor{comment}{            // na pierwszym miejscu jest zapotrzebowanie w węźle, na drugim miejscu, na trzecim ImediateRetrieval, a na ostatnim czas zatrzymania w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00025}00025 \textcolor{comment}{            double result = serviceTimeEstimator.EstimateLoadUnloadTime(node.PackageCount, 0, (int)node.PackageCountForImediateRetrieval, 1);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00026}00026 \textcolor{comment}{            return result;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00027}00027 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00028}00028 \textcolor{comment}{        */}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00035}00035         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{double} CalculateServiceTime\_Eron(TNode node, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00036}00036         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00037}00037             \textcolor{keywordtype}{double} result = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00038}00038 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00039}00039             \textcolor{comment}{// na pierwszym miejscu jest zapotrzebowanie w węźle, na drugim miejscu, na trzecim ImediateRetrieval, a na ostatnim czas zatrzymania w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00040}00040             \textcolor{keywordflow}{if} (node.nodeType == 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00041}00041             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00042}00042                 result = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(node.PackageCount, 0, (\textcolor{keywordtype}{int})node.PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00043}00043             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00044}00044             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00045}00045             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00046}00046                 result = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, node.PackageCount, (\textcolor{keywordtype}{int})node.PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00047}00047             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00048}00048             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00049}00049         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00050}00050 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00059}00059         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{double} CalculateWaitingTime(TNode node, \textcolor{keywordtype}{double} thetaCurrent, \textcolor{keywordtype}{double} serviceTime, \textcolor{keywordtype}{double} tij)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00060}00060         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00061}00061             \textcolor{keywordtype}{double} result = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00062}00062             result = node.TimeWindowStart -\/ (thetaCurrent + serviceTime + tij); \textcolor{comment}{// ustalenie czasu oczekiwania na obsluge w rozpatrywanym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00063}00063             \textcolor{keywordflow}{if} (result < 0) \textcolor{comment}{// jeżeli poniżej 0, to w danym węźle nie czekamy po dojechaniu na miejsce}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00064}00064             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00065}00065                 result = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00066}00066             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00067}00067             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00068}00068         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00069}00069 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00076}00076         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} CanVehicleHandleNode\_new(List<TNode> Nodes, List<VVehicle> Vehicles,\textcolor{keywordtype}{int} k, \textcolor{keywordtype}{int} j)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00077}00077         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00078}00078             }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00079}00079             \textcolor{keywordtype}{bool} result = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00080}00080             result = Vehicles[k].roadProperties.EpCount <= Nodes[j].maxVehicleSize.EpCount}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00081}00081                 \&\& Vehicles[k].roadProperties.GrossVehicleWeight <= Nodes[j].maxVehicleSize.GrossVehicleWeight;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00082}00082 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00083}00083           \textcolor{comment}{//  for(int i = 0; i < Nodes[j].SpecialProperties.Length; i++) // HACK-\/ przyjmujemy, że special properties to tablice równej długości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00084}00084           \textcolor{comment}{//  \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00085}00085           \textcolor{comment}{//      result \&= Nodes[j].SpecialProperties[i] \&\& Vehicles[k].SpecialProperties[i];}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00086}00086           \textcolor{comment}{//  \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00087}00087 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00088}00088             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00089}00089         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00090}00090 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00096}00096         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} NodeErrorStatus(TNode x)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00097}00097         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00098}00098             \textcolor{keywordflow}{return} x.errorNode;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00099}00099         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00100}00100 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00101}00101 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00114}00114         \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00115}00115 \textcolor{comment}{        public static bool CheckTimeConstraints(List<TNode> Nodes, double thetaNext, double rideTime, double rideLength, int index, TNode node, VVehicle vehicle, ITimeEstimator serviceTimeEstimator, IDistanceProvider distanceProvider)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00116}00116 \textcolor{comment}{        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00117}00117 \textcolor{comment}{            bool[] flags = new bool[4] \{ false, false, false, false \};}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00118}00118 \textcolor{comment}{            bool result = false;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00119}00119 \textcolor{comment}{            double temp\_time = serviceTimeEstimator.EstimateLoadUnloadTime(node.PackageCount, 0, (int)node.PackageCountForImediateRetrieval, 1);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00120}00120 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00121}00121 \textcolor{comment}{            if (thetaNext + temp\_time}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00122}00122 \textcolor{comment}{                + distanceProvider.GetDistance(Nodes[index].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00123}00123 \textcolor{comment}{            Nodes[0].location, vehicle.roadProperties).Time <= vehicle.AvailabilityEnd)             // wyliczenie czasu podrozy z wezla kandydata do MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00124}00124 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00125}00125 \textcolor{comment}{                flags[0] = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00126}00126 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00127}00127 \textcolor{comment}{            if (rideTime + distanceProvider.GetDistance(Nodes[index].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00128}00128 \textcolor{comment}{            Nodes[0].location, vehicle.roadProperties).Time <= vehicle.MaxRideTime)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00129}00129 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00130}00130 \textcolor{comment}{                flags[1] = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00131}00131 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00132}00132 \textcolor{comment}{            if (rideLength + distanceProvider.GetDistance(Nodes[index].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00133}00133 \textcolor{comment}{            Nodes[0].location, vehicle.roadProperties).Length <= vehicle.MaxRideLength)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00134}00134 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00135}00135 \textcolor{comment}{                flags[2] = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00136}00136 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00137}00137 \textcolor{comment}{            if (thetaNext + temp\_time}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00138}00138 \textcolor{comment}{                + distanceProvider.GetDistance(Nodes[index].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00139}00139 \textcolor{comment}{            Nodes[0].location, vehicle.roadProperties).Time <= Nodes[0].TimeWindowEnd)            // wyliczenie czasu podrozy z wezla kandydata do MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00140}00140 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00141}00141 \textcolor{comment}{                flags[3] = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00142}00142 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00143}00143 \textcolor{comment}{            if (flags[0] \&\& flags[1] \&\& flags[2] \&\& flags[3])}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00144}00144 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00145}00145 \textcolor{comment}{                result = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00146}00146 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00147}00147 \textcolor{comment}{            return result;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00148}00148 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00149}00149 \textcolor{comment}{      */}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00162}00162         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} CheckTimeConstraints\_Eron(List<TNode> Nodes, List<int> candRoutes,  \textcolor{keywordtype}{double} thetaNext, \textcolor{keywordtype}{double} rideTime, \textcolor{keywordtype}{double} rideLength, \textcolor{keywordtype}{int} index, TNode node, VVehicle vehicle, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00163}00163         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00164}00164             \textcolor{keywordtype}{bool}[] flags = \textcolor{keyword}{new} \textcolor{keywordtype}{bool}[4] \{ \textcolor{keyword}{false}, \textcolor{keyword}{false}, \textcolor{keyword}{false}, \textcolor{keyword}{false} \};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00165}00165             \textcolor{keywordtype}{bool} result = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00166}00166             \textcolor{keywordtype}{double} temp\_time = 0.0; \textcolor{comment}{// czas obsługi Node }}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00167}00167             \textcolor{keywordtype}{double} temp\_time\_2 = 0.0;   \textcolor{comment}{// czas rozładunku towaru w Depot (od dostawców)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00168}00168 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00169}00169             \textcolor{keywordflow}{if} (node.nodeType == 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00170}00170             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00171}00171                 temp\_time = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(node.PackageCount, 0, (\textcolor{keywordtype}{int})node.PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00172}00172             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00173}00173             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00174}00174             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00175}00175                 temp\_time = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, node.PackageCount, (\textcolor{keywordtype}{int})node.PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00176}00176             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00177}00177             \textcolor{keywordflow}{if} (TotalPickUpSize(Nodes,candRoutes) > 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00178}00178             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00179}00179                 temp\_time\_2 = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, TotalPickUpSize(Nodes, candRoutes), (\textcolor{keywordtype}{int})node.PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00180}00180             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00181}00181             }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00182}00182 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00183}00183             \textcolor{keywordflow}{if} (thetaNext + temp\_time + temp\_time\_2}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00184}00184                 + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[index].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00185}00185             Nodes[0].location, vehicle.roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}} <= vehicle.AvailabilityEnd)             \textcolor{comment}{// czas przyjazdu do magazynu Z UWZGLĘDNIENIEM CZASU OBSŁUGI}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00186}00186             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00187}00187                 flags[0] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00188}00188             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00189}00189             \textcolor{keywordtype}{double} val = distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[index].location, Nodes[0].location, vehicle.roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00190}00190             \textcolor{comment}{//if (val == 15826) rideTime -\/= 10000;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00191}00191             \textcolor{comment}{//if (val == 14514) rideTime -\/= 10000;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00192}00192             \textcolor{keywordflow}{if} (rideTime + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[index].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00193}00193             Nodes[0].location, vehicle.roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}} <= vehicle.MaxRideTime)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00194}00194             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00195}00195                 flags[1] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00196}00196             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00197}00197             }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00198}00198             \textcolor{keywordflow}{if} (rideLength + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[index].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00199}00199             Nodes[0].location, vehicle.roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_aed3c63e7fd87ca262eecf0f9bbd8c328}{Length}} <= vehicle.MaxRideLength)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00200}00200             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00201}00201                 flags[2] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00202}00202             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00203}00203             \textcolor{keywordflow}{if} (thetaNext + temp\_time + temp\_time\_2}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00204}00204                 + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[index].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00205}00205             Nodes[0].location, vehicle.roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}} <= Nodes[0].TimeWindowEnd)            \textcolor{comment}{// wyliczenie czasu podrozy z wezla kandydata do MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00206}00206             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00207}00207                 flags[3] = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00208}00208             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00209}00209             \textcolor{keywordflow}{if} (flags[0] \&\& flags[1] \&\& flags[2] \&\& flags[3])}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00210}00210             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00211}00211                 result = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00212}00212             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00213}00213             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00214}00214         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00215}00215 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00223}00223         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} DemandNodeAddOk\_new(TNode x, \textcolor{keywordtype}{double}[] residualCapacity, \textcolor{keywordtype}{bool} timeWindowFeasible)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00224}00224         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00225}00225             \textcolor{keywordflow}{if} (x.DemandCapacity[0] == 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00226}00226             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00227}00227                 \textcolor{keywordflow}{return} LorEQ(x.PickupCapacity, residualCapacity) \&\& timeWindowFeasible;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00228}00228             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00229}00229             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00230}00230             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00231}00231                 \textcolor{keywordflow}{return} LorEQ(x.DemandCapacity, residualCapacity) \&\& timeWindowFeasible;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00232}00232             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00233}00233             }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00234}00234         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00235}00235 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00246}00246         \textcolor{keyword}{public} \textcolor{keyword}{static} List<List<TRouteNode>> GreedyInsertHeuristic(List<TNode> Nodes, List<int> unroutedNodes, List<VVehicle> vehicles, List<List<TRouteNode>> start\_routes, \textcolor{keywordtype}{double}[] weights, \textcolor{keywordtype}{byte} param\_7\_penalty\_function\_type, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00247}00247         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00248}00248             List<List<TRouteNode>> routes = \textcolor{keyword}{new} List<List<TRouteNode>>();}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00249}00249             TSolution initial\_solution = \textcolor{keyword}{new} TSolution(start\_routes.Count);                      \textcolor{comment}{// puste rozwiazanie dla K pojazdow}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00250}00250             initial\_solution.CreateInitial(start\_routes);  \textcolor{comment}{// będziemy działać na obiekcie TSolution -\/ żeby korzystać z metody RouteOutcome}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00251}00251             \textcolor{keywordtype}{double}[] fObj = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[\mbox{\hyperlink{class_v_r_p_t_w_optimizer_1_1_b_l_1_1_s_a_1_1_simulated_annealing_1_1_simmulated_annealing_v_r_p_t_w_optimizer}{SimmulatedAnnealingVRPTWOptimizer}}.NBRFCOST]; \textcolor{comment}{// nieużywana tablica -\/ sprawdzamy tylko, czy nowa trasa jest dopuszczalna, a jej ocena jest nieistotna}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00252}00252             \textcolor{keywordtype}{bool} solution\_flag = \textcolor{keyword}{false}; \textcolor{comment}{// flaga ustawiana na TRUE, jeżeli do jednej z istniejących tras udało się wstawić węzeł}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00253}00253             \textcolor{keywordtype}{bool} exit\_flag = \textcolor{keyword}{false};  \textcolor{comment}{// flaga pomocnicza do wyjśca z pętli zewnętrznej, jeżeli udało się rozszerzyć istniejącą trasę}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00254}00254             TRouteNode routeNode;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00255}00255             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = unroutedNodes.Count -\/ 1; i >= 0; i-\/-\/)  \textcolor{comment}{// iterujemy od końca, bo na bieżąco usuwamy dodane węzły z listy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00256}00256             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00257}00257                 solution\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00258}00258                 exit\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00259}00259                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < initial\_solution.X.Count; j++)  \textcolor{comment}{// metoda bruteForce -\/ próbujemy wstawić węzeł na każde możliwe miejsce w istniejących trasach}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00260}00260                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00261}00261                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = 1; k < initial\_solution.X[j].Count; k++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00262}00262                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00263}00263                         initial\_solution.X[j].Insert(k, unroutedNodes[i]);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00264}00264 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00265}00265                         initial\_solution.RouteOutcome\_Eron(Nodes, vehicles, j, initial\_solution.X[j], ref solution\_flag, param\_7\_penalty\_function\_type, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00266}00266                         \textcolor{keywordflow}{if} (solution\_flag == \textcolor{keyword}{true})  \textcolor{comment}{// jeżeli po dodaniu nowego węzła rozwiązanie jest wciąż akceptowalne, to usuwamy węzeł z listy nieobsłużonych}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00267}00267                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00268}00268                             exit\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00269}00269                             unroutedNodes.RemoveAt(i);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00270}00270                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00271}00271                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00272}00272                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00273}00273                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00274}00274                             initial\_solution.X[j].RemoveAt(k);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00275}00275                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00276}00276                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00277}00277                     \textcolor{keywordflow}{if} (exit\_flag == \textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00278}00278                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00279}00279                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00280}00280                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00281}00281                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00282}00282             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00283}00283 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00284}00284             \textcolor{comment}{// z obiektu TSolution budujemy trasę w postaci listy <TRouteNode>}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00285}00285             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < initial\_solution.X.Count; i++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00286}00286             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00287}00287                 routes.Add(\textcolor{keyword}{new} List<TRouteNode>());}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00288}00288                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < initial\_solution.X[i].Count; j++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00289}00289                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00290}00290                     routeNode = \textcolor{keyword}{new} TRouteNode(initial\_solution.X[i][j], vehicles[i].ID, 0.0, 0.0, 0.0, 0.0);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00291}00291                     routes[i].Add(routeNode);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00292}00292                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00293}00293             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00294}00294             \textcolor{keywordflow}{return} routes;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00295}00295         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00296}00296 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00297}00297 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00307}00307         \textcolor{keyword}{public} \textcolor{keyword}{static} List<List<TRouteNode>> GreedyRoute\_Eron(List<int> unroutedNodes, List<VVehicle> Vehicles, List<TNode> Nodes, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00308}00308         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00309}00309             List<List<TRouteNode>> routes = \textcolor{keyword}{new} List<List<TRouteNode>>();}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00310}00310 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00311}00311             \textcolor{comment}{// Wagi dla zachlannej reguly wyboru nastepnego wezla na trasie}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00312}00312             \textcolor{keywordtype}{double} lambda\_1 = 0.5;                      \textcolor{comment}{// waga dla czasu podrozy od ostatniego wezla na budowanej trasie (wezel i) do wezla nastepnego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00313}00313             \textcolor{keywordtype}{double} lambda\_2 = 0.5;                      \textcolor{comment}{// waga dla czasu oczekiwania w wezle nastepnym}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00314}00314 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00315}00315             \textcolor{comment}{// zmienne pomocnicze}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00316}00316             \textcolor{keywordtype}{int} i;                           \textcolor{comment}{// indeks aktualnie odwiedzonego przez pojazd wezla (ostatni wezel, ktory udalo sie dodac do trasy pojazdu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00317}00317             \textcolor{keywordtype}{int} jPrim;                       \textcolor{comment}{// indeks nastepnego do odwiedzenia wezla (wezel kandydat) przez pojazd z wezla i}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00318}00318             \textcolor{keywordtype}{int} k = 0;                       \textcolor{comment}{// indeks pojazdu, dla ktorego aktualnie budowana jest trasa;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00319}00319             \textcolor{keywordtype}{int} uv = 0;                      \textcolor{comment}{// liczba wykorzystanych do tej pory pojazdow floty z wektora Vehicles}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00320}00320 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00321}00321             \textcolor{keywordtype}{double} rideTime;                \textcolor{comment}{// laczny czas jazdy pojazdu podczas juz zbudowanej trasy;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00322}00322             \textcolor{keywordtype}{double} rideLength;               \textcolor{comment}{// dlugosc juz zbudowanej trasy pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00323}00323             \textcolor{keywordtype}{double} thetaCurrent;            \textcolor{comment}{// czas rozpoczecia obslugi w aktualnym wezle trasy, czyli ostatnim wezle juz zbudowanej trasie pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00324}00324             \textcolor{keywordtype}{double} thetaNext;               \textcolor{comment}{// czas rozpoczecia obslugi w wyznaczonym zachlannie kandydacie na kolejny wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00325}00325 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00326}00326             \textcolor{keywordtype}{bool} allTimeWindowsFeasible;     \textcolor{comment}{// zmienna flaga z informacją, czy po dodaniu nowego węzła do trasy, gdzieś w węźle trasy nie nastąpi przyjazd w chwili > TimeWindowsEnd tego wezla}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00327}00327 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00328}00328             \textcolor{keywordtype}{double}[] residualVehicleCapacity = \textcolor{keyword}{new} \textcolor{keywordtype}{double}[Vehicles[0].Capacity.Length]; \textcolor{comment}{// okresla ile jeszcze masy ladunku pojazd moze przyjac}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00329}00329 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00330}00330             TRouteNode routeNode;                                                  \textcolor{comment}{// element trasy pojazdu, ktory bedzie wupelniony i dodany do trasy pojazdu, jezeli po uwzgl. wezla kandydata, trasa bedzie dopuszczalna}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00331}00331             List<int> demandOKNodes = \textcolor{keyword}{new} List<int>();                             \textcolor{comment}{// lista numerow wezlow nieobsluzonych, ktorych popyt  nie przekracza obu resztowych zdolnosci pojazdu i do ktorych pojazd MOZE dojechac (odleglosc i-\/-\/>x nie jest nieskonczona)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00332}00332             List<int> candRoute = \textcolor{keyword}{new} List<int>();                                \textcolor{comment}{// indeksy wezlow aktualnie zbudowanej trasy + wezel nieobsluzony}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00333}00333 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00334}00334             \textcolor{keywordtype}{double} minCriterion = \textcolor{keywordtype}{double}.PositiveInfinity;                \textcolor{comment}{// przechowywanie wartości kryterium dla najlepszego kandydata na kolejny węzeł trasy -\/ wyznaczane jako suma ważona odległości i czasu oczekiwania w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00335}00335             \textcolor{keywordtype}{int} jMin = -\/1;                   \textcolor{comment}{// początkowy pusty numer indeksu sklepu wskazujący na podstawie zmiennej criterion, który sklep powinien zostać dodany do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00336}00336             \textcolor{keywordtype}{double} criterion = 0.0;          \textcolor{comment}{// zmienna do wybierania najlepszego nowego sklepu do dodania do trasy (na podstawie odległości i czasu oczekiwania samochodu po dojeździe do sklepu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00337}00337             \textcolor{keywordtype}{double} tij = 0.0;                \textcolor{comment}{// droga/czas pomiędzy punktami i oraz j}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00338}00338             \textcolor{keywordtype}{double} serviceTime = 0.0;        \textcolor{comment}{// czas obsługi w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00339}00339             \textcolor{keywordtype}{double} waitingTime = 0.0;        \textcolor{comment}{// czas czekania po dojechaniu do węzła}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00340}00340 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00341}00341             \textcolor{keywordflow}{foreach} (var a \textcolor{keywordflow}{in} Vehicles)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00342}00342             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00343}00343                 routes.Add(\textcolor{keyword}{new} List<TRouteNode>()); \textcolor{comment}{// tworzenie pustych tras dla każdego z pojazdów}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00344}00344             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00345}00345 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00346}00346             \textcolor{keywordflow}{do}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00347}00347             \{  \textcolor{comment}{// budowanie tras dla pojazdow z floty pojazdow Vehicles do chwili, gdy wyczerpana zostanie lista nieobsluzonych klientow lub zabraknie pojazdow}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00348}00348                 jPrim = 0;                                                                             \textcolor{comment}{// pierwszy element trasy to wezel o indeksie 0 (MAGAZYN)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00349}00349                 rideTime = 0.0;                    \textcolor{comment}{// początkowy czas jazdy i długość trasy to 0}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00350}00350                 rideLength = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00351}00351 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00352}00352                 thetaCurrent = Vehicles[k].AvailabilityStart;                  \textcolor{comment}{// czas rozpoczecia obslugi w MAGAZYN to po prostu czas jego dostepnosci, pojazd tam juz stoi i czeka}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00353}00353 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00354}00354                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < residualVehicleCapacity.Length; index++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00355}00355                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00356}00356                     residualVehicleCapacity[index] = Vehicles[k].Capacity[index]; \textcolor{comment}{// wielowymiarowe możliwości początkowe pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00357}00357                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00358}00358 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00359}00359                 routeNode = \textcolor{keyword}{new} TRouteNode(jPrim, Vehicles[k].ID, Vehicles[k].AvailabilityStart, Vehicles[k].AvailabilityStart, 0.0, 0.0); \textcolor{comment}{// jest ok -\/ ma być dwa razy AvailabilityStart}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00360}00360                 routes[k].Add(routeNode);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00361}00361 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00362}00362                 \textcolor{keywordflow}{while} (\textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00363}00363                 \{   \textcolor{comment}{// Proba powiekszania trasy pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00364}00364                     i = jPrim;                  \textcolor{comment}{// ustal indeks wezla, od ktorego bedziesz dalej powiekszal trase}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00365}00365 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00366}00366                     demandOKNodes.Clear();}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00367}00367 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00368}00368                     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} x = 0; x < unroutedNodes.Count; x++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00369}00369                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00370}00370                         candRoute.Clear();}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00371}00371                         \textcolor{keywordflow}{foreach} (var a \textcolor{keywordflow}{in} routes[k])}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00372}00372                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00373}00373                             candRoute.Add(a.NodeID);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00374}00374                         \}   \textcolor{comment}{// dodane wezly aktualnie zbudowanej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00375}00375 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00376}00376                         candRoute.Add(x); \textcolor{comment}{// dodanie wezla nieobsluzonego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00377}00377 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00378}00378                         allTimeWindowsFeasible = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00379}00379                         ServiceTimeStart\_Eron(Nodes, Vehicles, k, candRoute, \textcolor{keyword}{false}, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);  \textcolor{comment}{// w tym miejscu nie potrzebujemy zwrotki z tej funkcji}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00380}00380 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00381}00381                         \textcolor{keywordflow}{if} (DemandNodeAddOk\_new(Nodes[unroutedNodes[x]], residualVehicleCapacity, allTimeWindowsFeasible) \&\& CanVehicleHandleNode\_new(Nodes, Vehicles, k, unroutedNodes[x]) \&\& NodeErrorStatus(Nodes[unroutedNodes[x]])==\textcolor{keyword}{false})}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00382}00382                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00383}00383                             demandOKNodes.Add(unroutedNodes[x]); \textcolor{comment}{// dodaj wezel do listy wezlow, z ktorych wybrany zostanie kandydat do powiekszenia trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00384}00384                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00385}00385                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00386}00386 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00387}00387                     allTimeWindowsFeasible = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00388}00388                     \textcolor{keywordflow}{if} (demandOKNodes.Count != 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00389}00389                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00390}00390                         \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ START SelectNextNode}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00391}00391                         minCriterion = \textcolor{keywordtype}{double}.PositiveInfinity;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00392}00392                         jMin = -\/1;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00393}00393                         criterion = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00394}00394                         tij = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00395}00395                         serviceTime = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00396}00396                         waitingTime = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00397}00397                         \textcolor{keywordtype}{double} crit\_add = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00398}00398                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = 0; j < demandOKNodes.Count; j++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00399}00399                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00400}00400                             tij = distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[i].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00401}00401                                Nodes[demandOKNodes[j]].location, Vehicles[k].roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00402}00402 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00403}00403                             serviceTime = CalculateServiceTime\_Eron(Nodes[demandOKNodes[j]], serviceTimeEstimator);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00404}00404 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00405}00405                             \textcolor{comment}{// ******************************************************}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00406}00406                             \textcolor{keywordtype}{double} preffTimeDiffer = thetaCurrent + serviceTime + tij;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00407}00407                             \textcolor{keywordtype}{double} val\_4 = 0.0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00408}00408                             \textcolor{keywordtype}{double} lambda\_3 = 0.01;  \textcolor{comment}{// TODO Zwiększyć i sprawdzić ten kawałek kodu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00409}00409                             \textcolor{keywordflow}{if} (preffTimeDiffer < Nodes[demandOKNodes[j]].PrefTimeWindowStart)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00410}00410                             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00411}00411                                 val\_4 = Nodes[demandOKNodes[j]].PrefTimeWindowStart -\/ preffTimeDiffer;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00412}00412                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00413}00413                             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (preffTimeDiffer > Nodes[demandOKNodes[j]].PrefTimeWindowEnd)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00414}00414                             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00415}00415                                 val\_4 = preffTimeDiffer -\/ Nodes[demandOKNodes[j]].PrefTimeWindowEnd;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00416}00416                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00417}00417                             \textcolor{comment}{// *****************************************************}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00418}00418 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00419}00419                             waitingTime = CalculateWaitingTime(Nodes[demandOKNodes[j]], thetaCurrent, serviceTime, tij);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00420}00420 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00421}00421                             \textcolor{keywordtype}{double} crit\_add\_new = 0.0;  \textcolor{comment}{// zamiast liczenia tylko po liczbie palet, teraz}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00422}00422                             \textcolor{comment}{// dostosujemy na podstawie wszystkich wymiarów -\/ w tym wypadku palet i wagi}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00423}00423                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < residualVehicleCapacity.Length; index++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00424}00424                             \{   \textcolor{comment}{// ale sprawdzamy tylko dla sumowanych elementów, np. palety, czy waga. Nie sumujemy np. wysokości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00425}00425                                 \textcolor{keywordflow}{if} (Nodes[demandOKNodes[j]].NodeAggregationType[index] == Enums.Aggregation.Sum)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00426}00426                                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00427}00427                                     \textcolor{keywordflow}{if} ((Nodes[demandOKNodes[j]].nodeType ==0) \&\& (Nodes[demandOKNodes[j]].DemandCapacity[index] != 0.0))}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00428}00428                                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00429}00429                                         crit\_add\_new += residualVehicleCapacity[index] / Nodes[demandOKNodes[j]].DemandCapacity[index];}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00430}00430                                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00431}00431                                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (Nodes[demandOKNodes[j]].PickupCapacity[index] != 0.0)  }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00432}00432                                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00433}00433                                         crit\_add\_new += residualVehicleCapacity[index] / Nodes[demandOKNodes[j]].PickupCapacity[index];}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00434}00434                                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00435}00435                                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00436}00436                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00437}00437 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00438}00438                             criterion = lambda\_1 * tij + lambda\_2 * waitingTime + lambda\_3 * val\_4 + crit\_add\_new * 1000.0;  \textcolor{comment}{// TODO -\/ zestawienie tablicy, a nie tylko EPCount!!!}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00439}00439 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00440}00440                             \textcolor{keywordflow}{if} (criterion < minCriterion)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00441}00441                             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00442}00442                                 minCriterion = criterion;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00443}00443                                 jMin = demandOKNodes[j];    \textcolor{comment}{// wskazujamy, które Node ma najmniejszą wartość criterion}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00444}00444                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00445}00445                         \} \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ END  SelectNextNode}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00446}00446                         jPrim = jMin; \textcolor{comment}{//jprim, czyli indeks wezla kandydata do dolozenia do trasy juz ustalony}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00447}00447 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00448}00448                         rideTime = rideTime + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[i].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00449}00449                             Nodes[jPrim].location, Vehicles[k].roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00450}00450 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00451}00451                         rideLength = rideLength + distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[i].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00452}00452                             Nodes[jPrim].location, Vehicles[k].roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_aed3c63e7fd87ca262eecf0f9bbd8c328}{Length}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00453}00453 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00454}00454                         candRoute.Clear();}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00455}00455                         \textcolor{keywordflow}{foreach} (var a \textcolor{keywordflow}{in} routes[k])}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00456}00456                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00457}00457                             candRoute.Add(a.NodeID);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00458}00458                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00459}00459                         candRoute.Add(jPrim); \textcolor{comment}{// dodanie wezla kandydata}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00460}00460 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00461}00461                         thetaNext = ServiceTimeStart\_Eron(Nodes, Vehicles, k, candRoute, \textcolor{keyword}{false}, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00462}00462 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00463}00463                         \textcolor{comment}{// czy wszystkie warunki sa spelnione (trasa po dodaniu nowego wezla bedzie trasa dopuszczalna)?}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00464}00464                         \textcolor{comment}{// jezeli tak, to trzeba rozbudowac trase o wezel kandydat oraz uaktualnic liste nieobsluzonych klientow oraz resztowe zdolnosci pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00465}00465 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00466}00466                         \textcolor{keywordflow}{if} (Nodes[jPrim].nodeType == 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00467}00467                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00468}00468                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < residualVehicleCapacity.Length; index++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00469}00469                             \{   \textcolor{comment}{// ale sprawdzamy tylko dla sumowanych elementów, np. palety, czy waga. Nie sumujemy np. wysokości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00470}00470                                 \textcolor{keywordflow}{if} (Nodes[jPrim].NodeAggregationType[index] == Enums.Aggregation.Sum)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00471}00471                                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00472}00472                                     residualVehicleCapacity[index] -\/= Nodes[jPrim].DemandCapacity[index];}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00473}00473                                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00474}00474                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00475}00475                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00476}00476                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00477}00477                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00478}00478                             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < residualVehicleCapacity.Length; index++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00479}00479                             \{   \textcolor{comment}{// ale sprawdzamy tylko dla sumowanych elementów, np. palety, czy waga. Nie sumujemy np. wysokości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00480}00480                                 \textcolor{keywordflow}{if} (Nodes[jPrim].NodeAggregationType[index] == Enums.Aggregation.Sum)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00481}00481                                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00482}00482                                     residualVehicleCapacity[index] -\/= Nodes[jPrim].PickupCapacity[index];}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00483}00483                                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00484}00484                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00485}00485                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00486}00486                         \textcolor{comment}{//sprawdzamy, czy na pewno pojazd ma wymaganą ładowność -\/ musi odbierać i zawozić towar}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00487}00487                         \textcolor{keywordtype}{bool} residualVehicleCapacity\_ok = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00488}00488                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} index = 0; index < residualVehicleCapacity.Length; index++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00489}00489                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00490}00490                             \textcolor{keywordflow}{if} (residualVehicleCapacity[index] < 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00491}00491                             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00492}00492                                 residualVehicleCapacity\_ok = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00493}00493                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00494}00494                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00495}00495 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00496}00496                         \textcolor{keywordflow}{if} (CheckTimeConstraints\_Eron(Nodes, candRoute, thetaNext, rideTime, rideLength, jPrim, Nodes[jPrim], Vehicles[k], serviceTimeEstimator, distanceProvider) \&\& residualVehicleCapacity\_ok == \textcolor{keyword}{true})}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00497}00497                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00498}00498                             routeNode = \textcolor{keyword}{new} TRouteNode(jPrim, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0); \textcolor{comment}{// na razie tylko dodawany jest indeks wezla powiekszajacego trase}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00499}00499                             routes[k].Add(routeNode);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00500}00500 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00501}00501                             thetaCurrent = thetaNext;                   \textcolor{comment}{// juz bedziemy sie w kolejnej probie rozbudowy trasy odnosic do czasu rozpoczecia obslugi w nowym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00502}00502                             unroutedNodes.RemoveAt(unroutedNodes.IndexOf(jPrim));  \textcolor{comment}{// aktualizacja listy nieobsluzonych wezlow <-\/-\/-\/ usuwamy z listy ten element, którego ID wezla wskazano wcześniej jako dodane do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00503}00503 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00504}00504                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00505}00505                         \textcolor{keywordflow}{else} \textcolor{comment}{// nie sa spelnione wszystkie warunki rozbudowy trasy, trzeba zakonczyc budowanie trasy dla biezacego pojazdu (przerwanie petli "{}while"{})}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00506}00506                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00507}00507                             routeNode = \textcolor{keyword}{new} TRouteNode(0, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00508}00508                             routes[k].Add(routeNode);   \textcolor{comment}{// dokładamy ostatni węzeł -\/ magazyn do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00509}00509                             candRoute.RemoveAt(candRoute.Count -\/ 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00510}00510                             candRoute.Add(0);    \textcolor{comment}{// "{}zamykamy"{} trasę candRoute tak, żeby ostatnim węzłem był magazyn, a nie Node, który nie spełniał warunków}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00511}00511                             thetaCurrent = ServiceTimeStart\_Eron(Nodes, Vehicles, k, candRoute, \textcolor{keyword}{false}, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);  \textcolor{comment}{// liczmy finalny czas przyjazdu pojazdu do magazynu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00512}00512 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00513}00513                             \textcolor{keywordflow}{if} (TotalPickUpSize(Nodes, candRoute) > 0) \textcolor{comment}{// koszt obsługi jest stały nawet, jeżeli liczba paczek wynosi 0}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00514}00514                             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00515}00515                                 thetaCurrent += serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, TotalPickUpSize(Nodes, candRoute), 0, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00516}00516                             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00517}00517                             \textcolor{comment}{//Vehicles[k].MaxRideTime = Vehicles[k].MaxRideTime -\/ rideTime;   // HACK !!! tutaj było -\/thetaCurrent, a ma być rideTime}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00518}00518                             Vehicles[k].AvailabilityStart = thetaCurrent;   \textcolor{comment}{// ustawiamy nowy czas początkowy pojazdu -\/ po obsłużeniu ewentualnej, wcześniejszej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00519}00519                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00520}00520                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00521}00521                     \} \textcolor{comment}{// END if -\/-\/ w ktorym badamy, czy dla danego pojazdu mozna jeszcze przydzielic jakis wezel (resztowe zdolnosci pojazdu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00522}00522                     \textcolor{keywordflow}{else} \textcolor{comment}{// Lista wezlow kandydatow do poszerzenia trasy jest pusta, bo resztowe zdolnosci ladunkowe sa za male}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00523}00523                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00524}00524                         \textcolor{comment}{// trzeba dodac wezel 0 (CD)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00525}00525                         routeNode = \textcolor{keyword}{new} TRouteNode(0, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00526}00526 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00527}00527                         routes[k].Add(routeNode);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00528}00528                         candRoute.RemoveAt(candRoute.Count -\/ 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00529}00529                         candRoute.Add(0);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00530}00530                         thetaCurrent = ServiceTimeStart\_Eron(Nodes, Vehicles, k, candRoute, \textcolor{keyword}{false}, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);   \textcolor{comment}{// przeliczamy thetaCurrent w sytuacji, kiedy węzeł Magazyn zostal dodany}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00531}00531 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00532}00532                         \textcolor{keywordflow}{if} (TotalPickUpSize(Nodes, candRoute) > 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00533}00533                         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00534}00534                             thetaCurrent += serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, TotalPickUpSize(Nodes, candRoute), 0, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00535}00535                         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00536}00536                         Vehicles[k].AvailabilityStart = thetaCurrent;   \textcolor{comment}{// ustawiamy nowy czas początkowy pojazdu -\/ po obsłużeniu ewentualnej, wcześniejszej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00537}00537                         \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00538}00538                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00539}00539                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00540}00540                 \textcolor{comment}{//Console.WriteLine("{}[INFO] END Budowanie trasy dla pojazdu o indeksie \{0\}"{}, k);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00541}00541                 ++uv;   \textcolor{comment}{// licznik wykorzystanych pojazdow wzrasta}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00542}00542                 ++k;    \textcolor{comment}{// wez kolejny pojazd}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00543}00543 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00544}00544                 \textcolor{keywordflow}{if} (uv == Vehicles.Count) \textcolor{comment}{// jezeli byl to ostatni dostepny pojazd floty, to zakoncz budowe rozwiazania poczatkowego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00545}00545                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00546}00546                     \textcolor{keywordflow}{break}; \textcolor{comment}{// repeat-\/until}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00547}00547                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00548}00548             \} \textcolor{keywordflow}{while} (unroutedNodes.Any());}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00549}00549 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00550}00550             \textcolor{keywordflow}{return} routes;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00551}00551         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00552}00552 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00553}00553 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00554}00554 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00564}00564 \textcolor{comment}{/* }}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00565}00565 \textcolor{comment}{        public static List<List<TRouteNode>> GreedyRoute(List<int> unroutedNodes, List<VVehicle> Vehicles, List<TNode> Nodes, ITimeEstimator serviceTimeEstimator, IDistanceProvider distanceProvider)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00566}00566 \textcolor{comment}{        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00567}00567 \textcolor{comment}{            List<List<TRouteNode>> routes = new List<List<TRouteNode>>();}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00568}00568 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00569}00569 \textcolor{comment}{            // Wagi dla zachlannej reguly wyboru nastepnego wezla na trasie}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00570}00570 \textcolor{comment}{            double lambda\_1 = 0.5;                      // waga dla czasu podrozy od ostatniego wezla na budowanej trasie (wezel i) do wezla nastepnego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00571}00571 \textcolor{comment}{            double lambda\_2 = 0.5;                      // waga dla czasu oczekiwania w wezle nastepnym}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00572}00572 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00573}00573 \textcolor{comment}{            // zmienne pomocnicze}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00574}00574 \textcolor{comment}{            int i;                           // indeks aktualnie odwiedzonego przez pojazd wezla (ostatni wezel, ktory udalo sie dodac do trasy pojazdu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00575}00575 \textcolor{comment}{            int jPrim;                       // indeks nastepnego do odwiedzenia wezla (wezel kandydat) przez pojazd z wezla i}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00576}00576 \textcolor{comment}{            int k = 0;                       // indeks pojazdu, dla ktorego aktualnie budowana jest trasa;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00577}00577 \textcolor{comment}{            int uv = 0;                      // liczba wykorzystanych do tej pory pojazdow floty z wektora Vehicles}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00578}00578 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00579}00579 \textcolor{comment}{            double rideTime;                // laczny czas jazdy pojazdu podczas juz zbudowanej trasy;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00580}00580 \textcolor{comment}{            double rideLength;               // dlugosc juz zbudowanej trasy pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00581}00581 \textcolor{comment}{            double thetaCurrent;            // czas rozpoczecia obslugi w aktualnym wezle trasy, czyli ostatnim wezle juz zbudowanej trasie pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00582}00582 \textcolor{comment}{            double thetaNext;               // czas rozpoczecia obslugi w wyznaczonym zachlannie kandydacie na kolejny wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00583}00583 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00584}00584 \textcolor{comment}{            bool allTimeWindowsFeasible;     // zmienna flaga z informacją, czy po dodaniu nowego węzła do trasy, gdzieś w węźle trasy nie nastąpi przyjazd w chwili > TimeWindowsEnd tego wezla}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00585}00585 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00586}00586 \textcolor{comment}{            double[] residualVehicleCapacity = new double[Vehicles[0].Capacity.Length]; // okresla ile jeszcze masy ladunku pojazd moze przyjac}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00587}00587 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00588}00588 \textcolor{comment}{            TRouteNode routeNode;                                                  // element trasy pojazdu, ktory bedzie wupelniony i dodany do trasy pojazdu, jezeli po uwzgl. wezla kandydata, trasa bedzie dopuszczalna}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00589}00589 \textcolor{comment}{            List<int> demandOKNodes = new List<int>();                             // lista numerow wezlow nieobsluzonych, ktorych popyt  nie przekracza obu resztowych zdolnosci pojazdu i do ktorych pojazd MOZE dojechac (odleglosc i-\/-\/>x nie jest nieskonczona)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00590}00590 \textcolor{comment}{            List<int> candRoute = new List<int>();                                // indeksy wezlow aktualnie zbudowanej trasy + wezel nieobsluzony}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00591}00591 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00592}00592 \textcolor{comment}{            double minCriterion = double.PositiveInfinity;                // przechowywanie wartości kryterium dla najlepszego kandydata na kolejny węzeł trasy -\/ wyznaczane jako suma ważona odległości i czasu oczekiwania w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00593}00593 \textcolor{comment}{            int jMin = -\/1;                   // początkowy pusty numer indeksu sklepu wskazujący na podstawie zmiennej criterion, który sklep powinien zostać dodany do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00594}00594 \textcolor{comment}{            double criterion = 0.0;          // zmienna do wybierania najlepszego nowego sklepu do dodania do trasy (na podstawie odległości i czasu oczekiwania samochodu po dojeździe do sklepu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00595}00595 \textcolor{comment}{            double tij = 0.0;                // droga/czas pomiędzy punktami i oraz j}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00596}00596 \textcolor{comment}{            double serviceTime = 0.0;        // czas obsługi w węźle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00597}00597 \textcolor{comment}{            double waitingTime = 0.0;        // czas czekania po dojechaniu do węzła}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00598}00598 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00599}00599 \textcolor{comment}{            foreach (var a in Vehicles)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00600}00600 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00601}00601 \textcolor{comment}{                routes.Add(new List<TRouteNode>()); // tworzenie pustych tras dla każdego z pojazdów}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00602}00602 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00603}00603 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00604}00604 \textcolor{comment}{            do}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00605}00605 \textcolor{comment}{            \{  // budowanie tras dla pojazdow z floty pojazdow Vehicles do chwili, gdy wyczerpana zostanie lista nieobsluzonych klientow lub zabraknie pojazdow}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00606}00606 \textcolor{comment}{                jPrim = 0;                                                                             // pierwszy element trasy to wezel o indeksie 0 (MAGAZYN)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00607}00607 \textcolor{comment}{                rideTime = 0.0;                    // początkowy czas jazdy i długość trasy to 0}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00608}00608 \textcolor{comment}{                rideLength = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00609}00609 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00610}00610 \textcolor{comment}{                thetaCurrent = Vehicles[k].AvailabilityStart;                  // czas rozpoczecia obslugi w MAGAZYN to po prostu czas jego dostepnosci, pojazd tam juz stoi i czeka}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00611}00611 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00612}00612 \textcolor{comment}{                for (int index = 0; index < residualVehicleCapacity.Length; index++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00613}00613 \textcolor{comment}{                \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00614}00614 \textcolor{comment}{                    residualVehicleCapacity[index] = Vehicles[k].Capacity[index]; // wielowymiarowe możliwości początkowe pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00615}00615 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00616}00616 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00617}00617 \textcolor{comment}{                routeNode = new TRouteNode(jPrim, Vehicles[k].ID, Vehicles[k].AvailabilityStart, Vehicles[k].AvailabilityStart, 0.0, 0.0); // jest ok -\/ ma być dwa razy AvailabilityStart}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00618}00618 \textcolor{comment}{                routes[k].Add(routeNode);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00619}00619 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00620}00620 \textcolor{comment}{                while (true)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00621}00621 \textcolor{comment}{                \{   // Proba powiekszania trasy pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00622}00622 \textcolor{comment}{                    i = jPrim;                  // ustal indeks wezla, od ktorego bedziesz dalej powiekszal trase}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00623}00623 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00624}00624 \textcolor{comment}{                    demandOKNodes.Clear();}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00625}00625 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00626}00626 \textcolor{comment}{                    for (int x = 0; x < unroutedNodes.Count; x++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00627}00627 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00628}00628 \textcolor{comment}{                        candRoute.Clear();}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00629}00629 \textcolor{comment}{                        foreach (var a in routes[k])}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00630}00630 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00631}00631 \textcolor{comment}{                            candRoute.Add(a.NodeID);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00632}00632 \textcolor{comment}{                        \}   // dodane wezly aktualnie zbudowanej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00633}00633 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00634}00634 \textcolor{comment}{                        candRoute.Add(x); // dodanie wezla nieobsluzonego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00635}00635 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00636}00636 \textcolor{comment}{                        allTimeWindowsFeasible = false;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00637}00637 \textcolor{comment}{                        ServiceTimeStart(Nodes,Vehicles,k, candRoute, false, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);  // w tym miejscu nie potrzebujemy zwrotki z tej funkcji}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00638}00638 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00639}00639 \textcolor{comment}{                        if (DemandNodeAddOk\_new(Nodes[unroutedNodes[x]], residualVehicleCapacity, allTimeWindowsFeasible) \&\& CanVehicleHandleNode\_new(Nodes,Vehicles,k, unroutedNodes[x]))}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00640}00640 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00641}00641 \textcolor{comment}{                            demandOKNodes.Add(unroutedNodes[x]); // dodaj wezel do listy wezlow, z ktorych wybrany zostanie kandydat do powiekszenia trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00642}00642 \textcolor{comment}{                        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00643}00643 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00644}00644 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00645}00645 \textcolor{comment}{                    allTimeWindowsFeasible = false;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00646}00646 \textcolor{comment}{                    if (demandOKNodes.Count != 0)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00647}00647 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00648}00648 \textcolor{comment}{                        // -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ START SelectNextNode}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00649}00649 \textcolor{comment}{                        minCriterion = double.PositiveInfinity;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00650}00650 \textcolor{comment}{                        jMin = -\/1;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00651}00651 \textcolor{comment}{                        criterion = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00652}00652 \textcolor{comment}{                        tij = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00653}00653 \textcolor{comment}{                        serviceTime = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00654}00654 \textcolor{comment}{                        waitingTime = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00655}00655 \textcolor{comment}{                        double crit\_add = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00656}00656 \textcolor{comment}{                        for (int j = 0; j < demandOKNodes.Count; j++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00657}00657 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00658}00658 \textcolor{comment}{                            tij = distanceProvider.GetDistance(Nodes[i].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00659}00659 \textcolor{comment}{                               Nodes[demandOKNodes[j]].location, Vehicles[k].roadProperties).Time;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00660}00660 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00661}00661 \textcolor{comment}{                            serviceTime = CalculateServiceTime(Nodes[demandOKNodes[j]], serviceTimeEstimator);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00662}00662 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00663}00663 \textcolor{comment}{                            // ******************************************************}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00664}00664 \textcolor{comment}{                            double preffTimeDiffer = thetaCurrent + serviceTime + tij;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00665}00665 \textcolor{comment}{                            double val\_4 = 0.0;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00666}00666 \textcolor{comment}{                            double lambda\_3 = 0.01;  // TODO Zwiększyć i sprawdzić ten kawałek kodu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00667}00667 \textcolor{comment}{                            if (preffTimeDiffer < Nodes[demandOKNodes[j]].PrefTimeWindowStart)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00668}00668 \textcolor{comment}{                            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00669}00669 \textcolor{comment}{                                val\_4 = Nodes[demandOKNodes[j]].PrefTimeWindowStart -\/ preffTimeDiffer;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00670}00670 \textcolor{comment}{                            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00671}00671 \textcolor{comment}{                            else if (preffTimeDiffer > Nodes[demandOKNodes[j]].PrefTimeWindowEnd)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00672}00672 \textcolor{comment}{                            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00673}00673 \textcolor{comment}{                                val\_4 = preffTimeDiffer -\/ Nodes[demandOKNodes[j]].PrefTimeWindowEnd;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00674}00674 \textcolor{comment}{                            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00675}00675 \textcolor{comment}{                            // *****************************************************}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00676}00676 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00677}00677 \textcolor{comment}{                            waitingTime = CalculateWaitingTime(Nodes[demandOKNodes[j]], thetaCurrent, serviceTime, tij);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00678}00678 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00679}00679 \textcolor{comment}{                            double crit\_add\_new = 0.0;  // zamiast liczenia tylko po liczbie palet, teraz}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00680}00680 \textcolor{comment}{                            // dostosujemy na podstawie wszystkich wymiarów -\/ w tym wypadku palet i wagi}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00681}00681 \textcolor{comment}{                            for (int index = 0; index < residualVehicleCapacity.Length; index++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00682}00682 \textcolor{comment}{                            \{   // ale sprawdzamy tylko dla sumowanych elementów, np. palety, czy waga. Nie sumujemy np. wysokości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00683}00683 \textcolor{comment}{                                if (Nodes[demandOKNodes[j]].NodeAggregationType[index] == Enums.Aggregation.Sum)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00684}00684 \textcolor{comment}{                                \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00685}00685 \textcolor{comment}{                                    if (Nodes[demandOKNodes[j]].DemandCapacity[index] > 0)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00686}00686 \textcolor{comment}{                                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00687}00687 \textcolor{comment}{                                        crit\_add\_new += residualVehicleCapacity[index] / Nodes[demandOKNodes[j]].DemandCapacity[index];}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00688}00688 \textcolor{comment}{                                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00689}00689 \textcolor{comment}{                                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00690}00690 \textcolor{comment}{                            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00691}00691 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00692}00692 \textcolor{comment}{                            criterion = lambda\_1 * tij + lambda\_2 * waitingTime + lambda\_3 * val\_4 + crit\_add\_new * 1000.0;  // TODO -\/ zestawienie tablicy, a nie tylko EPCount!!!}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00693}00693 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00694}00694 \textcolor{comment}{                            if (criterion < minCriterion)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00695}00695 \textcolor{comment}{                            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00696}00696 \textcolor{comment}{                                minCriterion = criterion;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00697}00697 \textcolor{comment}{                                jMin = demandOKNodes[j];    // wskazujamy, które Node ma najmniejszą wartość criterion}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00698}00698 \textcolor{comment}{                            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00699}00699 \textcolor{comment}{                        \} // -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/ END  SelectNextNode}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00700}00700 \textcolor{comment}{                        jPrim = jMin; //jprim, czyli indeks wezla kandydata do dolozenia do trasy juz ustalony}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00701}00701 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00702}00702 \textcolor{comment}{                        rideTime = rideTime + distanceProvider.GetDistance(Nodes[i].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00703}00703 \textcolor{comment}{                            Nodes[jPrim].location, Vehicles[k].roadProperties).Time;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00704}00704 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00705}00705 \textcolor{comment}{                        rideLength = rideLength + distanceProvider.GetDistance(Nodes[i].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00706}00706 \textcolor{comment}{                            Nodes[jPrim].location, Vehicles[k].roadProperties).Length;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00707}00707 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00708}00708 \textcolor{comment}{                        candRoute.Clear();}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00709}00709 \textcolor{comment}{                        foreach (var a in routes[k])}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00710}00710 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00711}00711 \textcolor{comment}{                            candRoute.Add(a.NodeID);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00712}00712 \textcolor{comment}{                        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00713}00713 \textcolor{comment}{                        candRoute.Add(jPrim); // dodanie wezla kandydata}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00714}00714 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00715}00715 \textcolor{comment}{                        thetaNext = ServiceTimeStart(Nodes, Vehicles, k, candRoute, false, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00716}00716 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00717}00717 \textcolor{comment}{                        // czy wszystkie warunki sa spelnione (trasa po dodaniu nowego wezla bedzie trasa dopuszczalna)?}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00718}00718 \textcolor{comment}{                        // jezeli tak, to trzeba rozbudowac trase o wezel kandydat oraz uaktualnic liste nieobsluzonych klientow oraz resztowe zdolnosci pojazdu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00719}00719 \textcolor{comment}{                        if (CheckTimeConstraints\_Eron(Nodes, candRoute, thetaNext, rideTime, rideLength, jPrim, Nodes[jPrim], Vehicles[k], serviceTimeEstimator, distanceProvider))}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00720}00720 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00721}00721 \textcolor{comment}{                            routeNode = new TRouteNode(jPrim, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0); // na razie tylko dodawany jest indeks wezla powiekszajacego trase}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00722}00722 \textcolor{comment}{                            routes[k].Add(routeNode);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00723}00723 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00724}00724 \textcolor{comment}{                            thetaCurrent = thetaNext;                   // juz bedziemy sie w kolejnej probie rozbudowy trasy odnosic do czasu rozpoczecia obslugi w nowym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00725}00725 \textcolor{comment}{                            unroutedNodes.RemoveAt(unroutedNodes.IndexOf(jPrim));  // aktualizacja listy nieobsluzonych wezlow <-\/-\/-\/ usuwamy z listy ten element, którego ID wezla wskazano wcześniej jako dodane do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00726}00726 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00727}00727 \textcolor{comment}{                            for (int index = 0; index < residualVehicleCapacity.Length; index++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00728}00728 \textcolor{comment}{                            \{   // ale sprawdzamy tylko dla sumowanych elementów, np. palety, czy waga. Nie sumujemy np. wysokości}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00729}00729 \textcolor{comment}{                                if (Nodes[jPrim].NodeAggregationType[index] == Enums.Aggregation.Sum)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00730}00730 \textcolor{comment}{                                \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00731}00731 \textcolor{comment}{                                    residualVehicleCapacity[index] -\/= Nodes[jPrim].DemandCapacity[index];}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00732}00732 \textcolor{comment}{                                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00733}00733 \textcolor{comment}{                            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00734}00734 \textcolor{comment}{                        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00735}00735 \textcolor{comment}{                        else // nie sa spelnione wszystkie warunki rozbudowy trasy, trzeba zakonczyc budowanie trasy dla biezacego pojazdu (przerwanie petli "{}while"{})}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00736}00736 \textcolor{comment}{                        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00737}00737 \textcolor{comment}{                            routeNode = new TRouteNode(0, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00738}00738 \textcolor{comment}{                            routes[k].Add(routeNode);   // dokładamy ostatni węzeł -\/ magazyn do trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00739}00739 \textcolor{comment}{                            candRoute.RemoveAt(candRoute.Count -\/ 1);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00740}00740 \textcolor{comment}{                            candRoute.Add(0);    // "{}zamykamy"{} trasę candRoute tak, żeby ostatnim węzłem był magazyn, a nie Node, który nie spełniał warunków}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00741}00741 \textcolor{comment}{                            thetaCurrent = ServiceTimeStart(Nodes, Vehicles, k, candRoute, false, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);  // liczmy finalny czas przyjazdu pojazdu do magazynu}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00742}00742 \textcolor{comment}{                            //Vehicles[k].MaxRideTime = Vehicles[k].MaxRideTime -\/ rideTime;   // HACK !!! tutaj było -\/thetaCurrent, a ma być rideTime}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00743}00743 \textcolor{comment}{                            Vehicles[k].AvailabilityStart = thetaCurrent;   // ustawiamy nowy czas początkowy pojazdu -\/ po obsłużeniu ewentualnej, wcześniejszej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00744}00744 \textcolor{comment}{                            break;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00745}00745 \textcolor{comment}{                        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00746}00746 \textcolor{comment}{                    \} // END if -\/-\/ w ktorym badamy, czy dla danego pojazdu mozna jeszcze przydzielic jakis wezel (resztowe zdolnosci pojazdu)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00747}00747 \textcolor{comment}{                    else // Lista wezlow kandydatow do poszerzenia trasy jest pusta, bo resztowe zdolnosci ladunkowe sa za male}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00748}00748 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00749}00749 \textcolor{comment}{                        // trzeba dodac wezel 0 (CD)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00750}00750 \textcolor{comment}{                        routeNode = new TRouteNode(0, Vehicles[k].ID, 0.0, 0.0, 0.0, 0.0);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00751}00751 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00752}00752 \textcolor{comment}{                        routes[k].Add(routeNode);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00753}00753 \textcolor{comment}{                        candRoute.RemoveAt(candRoute.Count -\/ 1);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00754}00754 \textcolor{comment}{                        candRoute.Add(0);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00755}00755 \textcolor{comment}{                        thetaCurrent = ServiceTimeStart(Nodes, Vehicles, k, candRoute, false, ref allTimeWindowsFeasible, serviceTimeEstimator, distanceProvider);   // przeliczamy thetaCurrent w sytuacji, kiedy węzeł Magazyn zostal dodany}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00756}00756 \textcolor{comment}{                        //Vehicles[k].MaxRideTime = Vehicles[k].MaxRideTime -\/ rideTime;   // TODO !!! tutaj było -\/thetaCurrent, a ma być rideTime}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00757}00757 \textcolor{comment}{                        Vehicles[k].AvailabilityStart = thetaCurrent;   // ustawiamy nowy czas początkowy pojazdu -\/ po obsłużeniu ewentualnej, wcześniejszej trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00758}00758 \textcolor{comment}{                        break;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00759}00759 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00760}00760 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00761}00761 \textcolor{comment}{                //Console.WriteLine("{}[INFO] END Budowanie trasy dla pojazdu o indeksie \{0\}"{}, k);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00762}00762 \textcolor{comment}{                ++uv;   // licznik wykorzystanych pojazdow wzrasta}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00763}00763 \textcolor{comment}{                ++k;    // wez kolejny pojazd}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00764}00764 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00765}00765 \textcolor{comment}{                if (uv == Vehicles.Count) // jezeli byl to ostatni dostepny pojazd floty, to zakoncz budowe rozwiazania poczatkowego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00766}00766 \textcolor{comment}{                \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00767}00767 \textcolor{comment}{                    break; // repeat-\/until}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00768}00768 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00769}00769 \textcolor{comment}{            \} while (unroutedNodes.Any());}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00770}00770 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00771}00771 \textcolor{comment}{            return routes;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00772}00772 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00773}00773 \textcolor{comment}{*/}       }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00780}00780         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} LorEQ(\textcolor{keywordtype}{double}[] A, \textcolor{keywordtype}{double}[] B)      \textcolor{comment}{// badamy po prostu, czy wektor A jest „<=” od wektora B po składowych}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00781}00781         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00782}00782             \textcolor{keywordtype}{bool} result = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00783}00783 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00784}00784             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < A.Length; i++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00785}00785             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00786}00786                 \textcolor{keywordflow}{if} (A[i] > B[i])}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00787}00787                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00788}00788                     result = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00789}00789                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00790}00790                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00791}00791             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00792}00792             \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00793}00793         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00794}00794 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00805}00805         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{double} ServiceTimeStart\_Eron(List<TNode> Nodes, List<VVehicle> Vehicles, \textcolor{keywordtype}{int} k, List<int> R, \textcolor{keywordtype}{bool} result, ref \textcolor{keywordtype}{bool} TWF, \mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator}{ITimeEstimator}} serviceTimeEstimator, \mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider}{IDistanceProvider}} distanceProvider)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00806}00806         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00807}00807             \textcolor{keywordtype}{int} SR = R.Count;            \textcolor{comment}{// łączna długość węzłód do odwiedzenia}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00808}00808             \textcolor{keywordtype}{double} theta\_current = 0.0;  \textcolor{comment}{// czas rozpoczecia obslugi w MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00809}00809             \textcolor{keywordtype}{double} tij;                  \textcolor{comment}{// czas przejazdu pomiędzy wskazanymi węzłami}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00810}00810             \textcolor{keywordtype}{double} p;                    \textcolor{comment}{// załadowanie całego wymaganego towaru z magazynu (Size * TimePerPickedUpPiece)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00811}00811             \textcolor{keywordtype}{double} s;                    \textcolor{comment}{// czas obslugi w poprzednim wezle trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00812}00812             \textcolor{keywordtype}{double} wt;                   \textcolor{comment}{// czas czekania po dojechaniu do węzła}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00813}00813             \textcolor{keywordtype}{double} at;                   \textcolor{comment}{// czas przyjazdu do aktualnego wezla: czas rozpoczecia obslugi w wezle poprzednim + czas dojazdu + czas obslugi w akt. wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00814}00814             \textcolor{keywordtype}{int} totalDemand = TotalDemandSize(Nodes, R);  \textcolor{comment}{// suma dostaw na trasie R}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00815}00815             \textcolor{keywordtype}{bool} tws\_flag = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00816}00816 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00817}00817             \textcolor{keywordtype}{double} pt = 0.0;             \textcolor{comment}{// łączna wartość różnic pomiędzy czasem przyjazdu, a czasem preferowanym}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00818}00818                                          \textcolor{comment}{// SimmulatedAnnealingVRPTWOptimizer.Nodes[0].}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00819}00819             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} c = 1; c < SR; c++)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00820}00820             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00821}00821                 \textcolor{keywordflow}{if} (c == 1)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00822}00822                 \{       \textcolor{comment}{// specjalny przypadek, w ktorym uwzgledniamy do wyliczenia czasu rozpoczecia obslugi w wezle aktualnym (drugim) czas obslugi zaladunku calosci towaru w MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00823}00823                     theta\_current = Vehicles[k].AvailabilityStart;      \textcolor{comment}{// chwila rozpoczecia obslugi w wezle MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00824}00824                     \textcolor{keywordtype}{int} j = R[c];   \textcolor{comment}{// indeks drugiego wezla trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00825}00825                     tij = distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[0].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00826}00826                         Nodes[j].location, Vehicles[k].roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00827}00827                     p = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, totalDemand, 0, 1); \textcolor{comment}{// czas obslugi w MAGAZYN, zwiazany z zaladowaniem dostaw dla wszystkich wezlow trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00828}00828                     at = theta\_current + p + tij;                       \textcolor{comment}{// czas przyjazdu do drugiego wezla trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00829}00829                     wt = Nodes[j].TimeWindowStart -\/ at;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00830}00830                     \textcolor{keywordflow}{if} (wt < 0) wt = 0.0;                               \textcolor{comment}{// ustalenie czasu oczekiwania na obsluge w drugim wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00831}00831                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00832}00832                         theta\_current = at + wt;                            \textcolor{comment}{// ustalenie czasu rozpoczecia obslugi w drugim wezle = czas przyjazdu do wezla drugiego powiekszony o czas oczekiwania w wezle drugim}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00833}00833                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00834}00834                     \textcolor{keywordflow}{if} (at > Nodes[j].TimeWindowEnd)                    \textcolor{comment}{// jezeli czas przyjazdu do wezla drugiego jest pozniejszy niz koniec jego okna czasowego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00835}00835                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00836}00836                         tws\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00837}00837                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00838}00838                     \textcolor{keywordflow}{if} (theta\_current < Nodes[j].PrefTimeWindowStart) pt = pt + Nodes[j].PrefTimeWindowStart -\/ theta\_current;  \textcolor{comment}{// node j, bo czas przyjazdu do węzła j, ale potem już aktualny węzeł, czyli "{}i"{} -\/ dlatego w else mamy "{}i"{}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00839}00839                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (theta\_current > Nodes[j].PrefTimeWindowEnd) pt = pt + theta\_current -\/ Nodes[j].PrefTimeWindowEnd;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00840}00840                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00841}00841                 \textcolor{keywordflow}{else}    \textcolor{comment}{// rozwazamy kolejne wezly, w ktorych uwzgledniamy tylko czas obslugi w tych wezlach do wyliczania czasu rozpoczecia obslugi w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00842}00842                 \{        \textcolor{comment}{// 0,..., i-\/1, i,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00843}00843                     \textcolor{keywordtype}{int} i = R[c];       \textcolor{comment}{// aktualny wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00844}00844                     \textcolor{keywordtype}{int} j = R[c -\/ 1];   \textcolor{comment}{// poprzedni wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00845}00845                     tij = distanceProvider.\mbox{\hyperlink{interface_common_g_i_s_1_1_interfaces_1_1_i_distance_provider_a91899eab2f7298972955f9144301b2ed}{GetDistance}}(Nodes[j].location,}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00846}00846                        Nodes[i].location, Vehicles[k].roadProperties).\mbox{\hyperlink{class_common_g_i_s_1_1_distance_a873fe0d3bc5a3a24c5916d2ea6176a90}{Time}};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00847}00847 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00848}00848                     \textcolor{keywordflow}{if} (Nodes[j].nodeType == 0) \textcolor{comment}{// jawnie rozdzielamy -\/ jeżeli sklep, to tylko rozładunek, jeżeli dostawca -\/ to tylko załadunek.}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00849}00849                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00850}00850                         s = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(Nodes[j].PackageCount, 0, (\textcolor{keywordtype}{int})Nodes[j].PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00851}00851                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00852}00852                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00853}00853                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00854}00854                         s = serviceTimeEstimator.\mbox{\hyperlink{interface_v_r_p_t_w_optimizer_1_1_interfaces_1_1_i_time_estimator_a98bc5e148758116e364366acb432c85c}{EstimateLoadUnloadTime}}(0, Nodes[j].PackageCount, (\textcolor{keywordtype}{int})Nodes[j].PackageCountForImediateRetrieval, 1);}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00855}00855                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00856}00856                         }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00857}00857                     at = theta\_current + s + tij;                       \textcolor{comment}{// czas przyjazdu do aktualnego wezla: czas rozpoczecia obslugi w wezle poprzednim + czas dojazdu + czas obslugi w akt. wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00858}00858                     wt = Nodes[i].TimeWindowStart -\/ at;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00859}00859                     \textcolor{keywordflow}{if} (wt < 0) wt = 0.0;                               \textcolor{comment}{// ustalenie czasu oczekiwania na obsluge w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00860}00860                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00861}00861                         theta\_current = at + wt;        \textcolor{comment}{// ustalenie czasu rozpoczecia obslugi w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00862}00862                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00863}00863                     \textcolor{keywordflow}{if} (at > Nodes[i].TimeWindowEnd)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00864}00864                     \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00865}00865                         tws\_flag = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00866}00866                     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00867}00867                     \textcolor{keywordflow}{if} (theta\_current < Nodes[i].PrefTimeWindowStart) pt = pt + Nodes[i].PrefTimeWindowStart -\/ theta\_current;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00868}00868                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (theta\_current > Nodes[i].PrefTimeWindowEnd) pt = pt + theta\_current -\/ Nodes[i].PrefTimeWindowEnd;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00869}00869                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00870}00870             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00871}00871             TWF = tws\_flag;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00872}00872 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00873}00873             \textcolor{keywordflow}{if} (result == \textcolor{keyword}{false}) \textcolor{keywordflow}{return} theta\_current;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00874}00874             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00875}00875             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00876}00876                 \textcolor{keywordflow}{return} pt;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00877}00877             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00878}00878         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00879}00879 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00880}00880 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00881}00881 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00892}00892         \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00893}00893 \textcolor{comment}{        public static double ServiceTimeStart(List<TNode> Nodes, List<VVehicle> Vehicles, int k, List<int> R, bool result, ref bool TWF, ITimeEstimator serviceTimeEstimator, IDistanceProvider distanceProvider)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00894}00894 \textcolor{comment}{        \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00895}00895 \textcolor{comment}{            int SR = R.Count;            // łączna długość węzłód do odwiedzenia}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00896}00896 \textcolor{comment}{            double theta\_current = 0.0;  // czas rozpoczecia obslugi w MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00897}00897 \textcolor{comment}{            double tij;                  // czas przejazdu pomiędzy wskazanymi węzłami}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00898}00898 \textcolor{comment}{            double p;                    // załadowanie całego wymaganego towaru z magazynu (Size * TimePerPickedUpPiece)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00899}00899 \textcolor{comment}{            double s;                    // czas obslugi w poprzednim wezle trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00900}00900 \textcolor{comment}{            double wt;                   // czas czekania po dojechaniu do węzła}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00901}00901 \textcolor{comment}{            double at;                   // czas przyjazdu do aktualnego wezla: czas rozpoczecia obslugi w wezle poprzednim + czas dojazdu + czas obslugi w akt. wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00902}00902 \textcolor{comment}{            int totalDemand = TotalDemandSize(Nodes,R);  // suma dostaw na trasie R}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00903}00903 \textcolor{comment}{            bool tws\_flag = true;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00904}00904 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00905}00905 \textcolor{comment}{            double pt = 0.0;             // łączna wartość różnic pomiędzy czasem przyjazdu, a czasem preferowanym}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00906}00906 \textcolor{comment}{                                         // SimmulatedAnnealingVRPTWOptimizer.Nodes[0].}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00907}00907 \textcolor{comment}{            for (int c = 1; c < SR; c++)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00908}00908 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00909}00909 \textcolor{comment}{                if (c == 1)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00910}00910 \textcolor{comment}{                \{       // specjalny przypadek, w ktorym uwzgledniamy do wyliczenia czasu rozpoczecia obslugi w wezle aktualnym (drugim) czas obslugi zaladunku calosci towaru w MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00911}00911 \textcolor{comment}{                    theta\_current = Vehicles[k].AvailabilityStart;      // chwila rozpoczecia obslugi w wezle MAGAZYN}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00912}00912 \textcolor{comment}{                    int j = R[c];   // indeks drugiego wezla trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00913}00913 \textcolor{comment}{                    tij = distanceProvider.GetDistance(Nodes[0].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00914}00914 \textcolor{comment}{                        Nodes[j].location, Vehicles[k].roadProperties).Time;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00915}00915 \textcolor{comment}{                    p = serviceTimeEstimator.EstimateLoadUnloadTime(0, totalDemand, 0, 1); // czas obslugi w MAGAZYN, zwiazany z zaladowaniem dostaw dla wszystkich wezlow trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00916}00916 \textcolor{comment}{                    at = theta\_current + p + tij;                       // czas przyjazdu do drugiego wezla trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00917}00917 \textcolor{comment}{                    wt = Nodes[j].TimeWindowStart -\/ at;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00918}00918 \textcolor{comment}{                    if (wt < 0) wt = 0.0;                               // ustalenie czasu oczekiwania na obsluge w drugim wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00919}00919 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00920}00920 \textcolor{comment}{                        theta\_current = at + wt;                            // ustalenie czasu rozpoczecia obslugi w drugim wezle = czas przyjazdu do wezla drugiego powiekszony o czas oczekiwania w wezle drugim}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00921}00921 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00922}00922 \textcolor{comment}{                    if (at > Nodes[j].TimeWindowEnd)                    // jezeli czas przyjazdu do wezla drugiego jest pozniejszy niz koniec jego okna czasowego}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00923}00923 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00924}00924 \textcolor{comment}{                        tws\_flag = false;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00925}00925 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00926}00926 \textcolor{comment}{                    if (theta\_current < Nodes[j].PrefTimeWindowStart) pt = pt + Nodes[j].PrefTimeWindowStart -\/ theta\_current;  // node j, bo czas przyjazdu do węzła j, ale potem już aktualny węzeł, czyli "{}i"{} -\/ dlatego w else mamy "{}i"{}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00927}00927 \textcolor{comment}{                    else if (theta\_current > Nodes[j].PrefTimeWindowEnd) pt = pt + theta\_current -\/ Nodes[j].PrefTimeWindowEnd;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00928}00928 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00929}00929 \textcolor{comment}{                else    // rozwazamy kolejne wezly, w ktorych uwzgledniamy tylko czas obslugi w tych wezlach do wyliczania czasu rozpoczecia obslugi w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00930}00930 \textcolor{comment}{                \{        // 0,..., i-\/1, i,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00931}00931 \textcolor{comment}{                    int i = R[c];       // aktualny wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00932}00932 \textcolor{comment}{                    int j = R[c -\/ 1];   // poprzedni wezel trasy}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00933}00933 \textcolor{comment}{                    tij = distanceProvider.GetDistance(SimmulatedAnnealingVRPTWOptimizer.Nodes[j].location,}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00934}00934 \textcolor{comment}{                       SimmulatedAnnealingVRPTWOptimizer.Nodes[i].location, SimmulatedAnnealingVRPTWOptimizer.Vehicles[k].v\_prop).Time;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00935}00935 \textcolor{comment}{                   }}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00936}00936 \textcolor{comment}{                    s = serviceTimeEstimator.EstimateLoadUnloadTime((int)SimmulatedAnnealingVRPTWOptimizer.Nodes[j].cargoDemandSize.Size, 0, (int)SimmulatedAnnealingVRPTWOptimizer.Nodes[j].PackageCountForImediateRetrieval, 1);}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00937}00937 \textcolor{comment}{                    at = theta\_current + s + tij;                       // czas przyjazdu do aktualnego wezla: czas rozpoczecia obslugi w wezle poprzednim + czas dojazdu + czas obslugi w akt. wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00938}00938 \textcolor{comment}{                    wt = Nodes[i].TimeWindowStart -\/ at;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00939}00939 \textcolor{comment}{                    if (wt < 0) wt = 0.0;                               // ustalenie czasu oczekiwania na obsluge w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00940}00940 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00941}00941 \textcolor{comment}{                        theta\_current = at + wt;        // ustalenie czasu rozpoczecia obslugi w aktualnym wezle}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00942}00942 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00943}00943 \textcolor{comment}{                    if (at > Nodes[i].TimeWindowEnd)}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00944}00944 \textcolor{comment}{                    \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00945}00945 \textcolor{comment}{                        tws\_flag = false;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00946}00946 \textcolor{comment}{                    \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00947}00947 \textcolor{comment}{                    if (theta\_current < Nodes[i].PrefTimeWindowStart) pt = pt + Nodes[i].PrefTimeWindowStart -\/ theta\_current;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00948}00948 \textcolor{comment}{                    else if (theta\_current > Nodes[i].PrefTimeWindowEnd) pt = pt + theta\_current -\/ Nodes[i].PrefTimeWindowEnd;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00949}00949 \textcolor{comment}{                \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00950}00950 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00951}00951 \textcolor{comment}{            TWF = tws\_flag;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00952}00952 \textcolor{comment}{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00953}00953 \textcolor{comment}{            if (result == false) return theta\_current;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00954}00954 \textcolor{comment}{            else}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00955}00955 \textcolor{comment}{            \{}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00956}00956 \textcolor{comment}{                return pt;}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00957}00957 \textcolor{comment}{            \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00958}00958 \textcolor{comment}{        \}}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00959}00959 \textcolor{comment}{        */}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00965}00965         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{int} TotalDemandSize(List<TNode>  Nodes, List<int> R)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00966}00966         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00967}00967             \textcolor{keywordtype}{int} totalDemandEpCount = 0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00968}00968             \textcolor{keywordflow}{foreach} (var x \textcolor{keywordflow}{in} R)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00969}00969             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00970}00970                 \textcolor{keywordflow}{if} (Nodes[x].nodeType == 0)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00971}00971                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00972}00972                     totalDemandEpCount += Nodes[x].PackageCount;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00973}00973                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00974}00974             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00975}00975             \textcolor{keywordflow}{return} totalDemandEpCount;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00976}00976         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00977}00977 }
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00978}00978         \textcolor{keyword}{public} \textcolor{keyword}{static} \textcolor{keywordtype}{int} TotalPickUpSize(List<TNode> Nodes, List<int> R)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00979}00979         \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00980}00980             \textcolor{keywordtype}{int} totalPickUpEpCount = 0;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00981}00981             \textcolor{keywordflow}{foreach} (var x \textcolor{keywordflow}{in} R)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00982}00982             \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00983}00983                 \textcolor{keywordflow}{if} (Nodes[x].nodeType == 1)}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00984}00984                 \{}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00985}00985                     totalPickUpEpCount += Nodes[x].PackageCount;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00986}00986                 \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00987}00987             \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00988}00988             \textcolor{keywordflow}{return} totalPickUpEpCount;}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00989}00989         \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00990}00990     \}}
\DoxyCodeLine{\Hypertarget{_initial_heuristic_8cs_source_l00991}00991 \}}

\end{DoxyCode}
